<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿåº§å‘½ç›¤æ’ç›¤å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
            background: #000;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #eee, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: twinkle 4s linear infinite;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: nebula 10s ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        @keyframes nebula {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .header {
            background: linear-gradient(45deg, rgba(255,107,107,0.8), rgba(238,90,36,0.8));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: 'âœ¨';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .input-section {
            padding: 40px;
            background: rgba(248, 249, 250, 0.1);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #fff;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            transition: border-color 0.3s;
        }

        input::placeholder, select option {
            color: rgba(255,255,255,0.7);
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .btn-generate {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .results {
            padding: 40px;
            display: none;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .planet-card {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.8) 0%, rgba(245, 87, 108, 0.8) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s;
        }

        .planet-card:hover {
            transform: translateY(-5px);
        }

        .planet-card.earth {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.8) 0%, rgba(0, 242, 254, 0.8) 100%);
        }

        .planet-card.moon {
            background: linear-gradient(135deg, rgba(250, 112, 154, 0.8) 0%, rgba(254, 225, 64, 0.8) 100%);
        }

        .planet-card.sun {
            background: linear-gradient(135deg, rgba(247, 151, 30, 0.8) 0%, rgba(255, 210, 0, 0.8) 100%);
        }

        .planet-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .zodiac-sign {
            font-size: 1.5em;
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }

        .degree {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .interpretation {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .interpretation h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
        }

        .interpretation p {
            line-height: 1.6;
            color: #fff;
            margin-bottom: 10px;
        }

        .zodiac-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .zodiac-card {
            background: rgba(248, 249, 250, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .zodiac-card h4 {
            color: #fff;
            margin-bottom: 10px;
        }

        .privacy {
            background: rgba(0,0,0,0.5);
            color: #ccc;
            padding: 20px;
            text-align: center;
            font-size: 0.9em;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .privacy a {
            color: #667eea;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .input-section, .results {
                padding: 20px;
            }
        }

        .loading {
            text-align: center;
            color: #fff;
            font-size: 1.1em;
        }

        .error {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
            background: rgba(255,107,107,0.1);
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŒ æ˜Ÿåº§å‘½ç›¤æ’ç›¤å·¥å…· ğŸŒŒ</h1>
            <p>æ¢ç´¢å®‡å®™çš„å¥§ç§˜ï¼Œè§£é–ä½ çš„æ˜Ÿè¾°æ•…äº‹</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="birthDate">å‡ºç”Ÿæ—¥æœŸ</label>
                <input type="date" id="birthDate" required>
            </div>
            
            <div class="input-group">
                <label for="birthTime">å‡ºç”Ÿæ™‚é–“</label>
                <input type="time" id="birthTime" required>
            </div>
            
            <div class="input-group">
                <label for="birthPlace">å‡ºç”Ÿåœ°é» (åŸå¸‚)</label>
                <input type="text" id="birthPlace" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚" required>
            </div>
            
            <button class="btn-generate" onclick="generateChart()">ğŸŒŸ ç”Ÿæˆå‘½ç›¤</button>
        </div>

        <div class="results" id="results">
            <div class="chart-grid" id="chartGrid"></div>
            
            <div class="interpretation" id="interpretation"></div>
            
            <div class="zodiac-info" id="zodiacInfo"></div>
        </div>

        <div class="privacy">
            <p>æœ¬å·¥å…·ä½¿ç”¨ AstrologyAPI æä¾›ç²¾æº–å¤©æ–‡è¨ˆç®—ã€‚æ‚¨çš„å‡ºç”Ÿè³‡æ–™åƒ…ç”¨æ–¼ç”Ÿæˆå€‹äººå‘½ç›¤ï¼Œä¸æœƒå„²å­˜æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹ã€‚<br>
            å¦‚æœ‰ç–‘æ…®ï¼Œè«‹åƒé–±æˆ‘å€‘çš„ <a href="#privacy">éš±ç§æ”¿ç­–</a>ã€‚</p>
        </div>
    </div>

    <script>
        // API è¨­å®š (ä½¿ç”¨æä¾›çš„ Key)
        const API_KEY = 'QHh4C2NS8q2GfaVyMe065AEYgBxpeBIaHTzUz5S6';
        const API_BASE = 'https://json.astrologyapi.com/v1';  // åŸºæ–¼æœå°‹çµæœçš„ç«¯é»

        // æ˜Ÿåº§æ—¥æœŸç¯„åœ (å¾Œå‚™ç”¨)
        const zodiacData = {
            'ç‰¡ç¾Šåº§': { start: '03-21', end: '04-19', element: 'ç«è±¡', quality: 'åŸºæœ¬', color: '#ff6b6b', en: 'Aries' },
            'é‡‘ç‰›åº§': { start: '04-20', end: '05-20', element: 'åœŸè±¡', quality: 'å›ºå®š', color: '#feca57', en: 'Taurus' },
            'é›™å­åº§': { start: '05-21', end: '06-20', element: 'é¢¨è±¡', quality: 'è®Šå‹•', color: '#48dbfb', en: 'Gemini' },
            'å·¨èŸ¹åº§': { start: '06-21', end: '07-22', element: 'æ°´è±¡', quality: 'åŸºæœ¬', color: '#ff9ff3', en: 'Cancer' },
            'ç…å­åº§': { start: '07-23', end: '08-22', element: 'ç«è±¡', quality: 'å›ºå®š', color: '#f7971e', en: 'Leo' },
            'è™•å¥³åº§': { start: '08-23', end: '09-22', element: 'åœŸè±¡', quality: 'è®Šå‹•', color: '#6c5ce7', en: 'Virgo' },
            'å¤©ç§¤åº§': { start: '09-23', end: '10-22', element: 'é¢¨è±¡', quality: 'åŸºæœ¬', color: '#a29bfe', en: 'Libra' },
            'å¤©è åº§': { start: '10-23', end: '11-21', element: 'æ°´è±¡', quality: 'å›ºå®š', color: '#fd79a8', en: 'Scorpio' },
            'å°„æ‰‹åº§': { start: '11-22', end: '12-21', element: 'ç«è±¡', quality: 'è®Šå‹•', color: '#fdcb6e', en: 'Sagittarius' },
            'æ‘©ç¾¯åº§': { start: '12-22', end: '01-19', element: 'åœŸè±¡', quality: 'åŸºæœ¬', color: '#e17055', en: 'Capricorn' },
            'æ°´ç“¶åº§': { start: '01-20', end: '02-18', element: 'é¢¨è±¡', quality: 'å›ºå®š', color: '#00cec9', en: 'Aquarius' },
            'é›™é­šåº§': { start: '02-19', end: '03-20', element: 'æ°´è±¡', quality: 'è®Šå‹•', color: '#74b9ff', en: 'Pisces' }
        };

        // è‹±æ–‡åˆ°ä¸­æ–‡æ˜Ÿåº§æ˜ å°„
        const enToZh = {
            'Aries': 'ç‰¡ç¾Šåº§', 'Taurus': 'é‡‘ç‰›åº§', 'Gemini': 'é›™å­åº§', 'Cancer': 'å·¨èŸ¹åº§',
            'Leo': 'ç…å­åº§', 'Virgo': 'è™•å¥³åº§', 'Libra': 'å¤©ç§¤åº§', 'Scorpio': 'å¤©è åº§',
            'Sagittarius': 'å°„æ‰‹åº§', 'Capricorn': 'æ‘©ç¾¯åº§', 'Aquarius': 'æ°´ç“¶åº§', 'Pisces': 'é›™é­šåº§'
        };

        // è¡Œæ˜Ÿè§£é‡‹ (ä¿æŒåŸæ¨£)
        const planetInterpretations = {
            sun: {
                'ç‰¡ç¾Šåº§': 'ç†±æƒ…å‹‡æ•¢çš„é ˜è¢–ï¼Œå……æ»¿è¡Œå‹•åŠ›èˆ‡é–‹å‰µç²¾ç¥ã€‚',
                'é‡‘ç‰›åº§': 'ç©©é‡è¸å¯¦çš„å¯¦è¸è€…ï¼Œé‡è¦–å®‰å…¨æ„Ÿèˆ‡ç‰©è³ªäº«å—ã€‚',
                'é›™å­åº§': 'æ©Ÿæ™ºéˆæ´»çš„æºé€šè€…ï¼Œæ€ç¶­æ•æ·ä¸”å¥½å¥‡å¿ƒå¼·ã€‚',
                'å·¨èŸ¹åº§': 'æº«æš–æ•æ„Ÿçš„å®ˆè­·è€…ï¼Œé‡è¦–å®¶åº­èˆ‡æƒ…æ„Ÿé€£çµã€‚',
                'ç…å­åº§': 'è‡ªä¿¡è€€çœ¼çš„è¡¨æ¼”è€…ï¼Œå……æ»¿å‰µé€ åŠ›èˆ‡é ˜å°é­…åŠ›ã€‚',
                'è™•å¥³åº§': 'ç´°å¿ƒè¬¹æ…çš„åˆ†æè€…ï¼Œè¿½æ±‚å®Œç¾èˆ‡å¯¦éš›æ•ˆç‡ã€‚',
                'å¤©ç§¤åº§': 'å„ªé›…å’Œè«§çš„èª¿åœè€…ï¼Œé‡è¦–ç¾æ„Ÿèˆ‡äººéš›å¹³è¡¡ã€‚',
                'å¤©è åº§': 'æ·±æ²‰ç¥ç§˜çš„æ¢éšªå®¶ï¼Œæ“æœ‰å¼·å¤§çš„æ„å¿—åŠ›èˆ‡æ´å¯ŸåŠ›ã€‚',
                'å°„æ‰‹åº§': 'æ¨‚è§€å†’éšªçš„å“²å­¸å®¶ï¼Œè¿½æ±‚è‡ªç”±èˆ‡çŸ¥è­˜æ¢ç´¢ã€‚',
                'æ‘©ç¾¯åº§': 'å‹™å¯¦åš´è¬¹çš„å»ºç¯‰å¸«ï¼Œç›®æ¨™æ˜ç¢ºä¸”æœ‰è€å¿ƒé”æˆã€‚',
                'æ°´ç“¶åº§': 'ç¨ç«‹å‰µæ–°çš„æ”¹é©è€…ï¼Œé‡è¦–äººé“ä¸»ç¾©èˆ‡ç¨ç‰¹è§€é»ã€‚',
                'é›™é­šåº§': 'å¤¢å¹»æ•æ„Ÿçš„è—è¡“å®¶ï¼Œå……æ»¿åŒç†å¿ƒèˆ‡ç›´è¦ºåŠ›ã€‚'
            },
            moon: {
                'ç‰¡ç¾Šåº§': 'æƒ…ç·’ç›´æ¥è€Œç†±çƒˆï¼Œéœ€è¦å³æ™‚è¡¨é”å…§å¿ƒæ„Ÿå—ã€‚',
                'é‡‘ç‰›åº§': 'å°‹æ±‚æƒ…æ„Ÿå®‰å…¨èˆ‡ç©©å®šï¼Œäº«å—æ„Ÿå®˜çš„èˆ’é©ã€‚',
                'é›™å­åº§': 'æ€ç·’æ´»èºï¼Œæƒ…æ„Ÿéœ€è¦ä¸æ–·çš„äº¤æµèˆ‡åˆºæ¿€ã€‚',
                'å·¨èŸ¹åº§': 'æ¥µåº¦æ•æ„Ÿä¸”ä¿è­·æ€§å¼·ï¼Œå®¶åº­æ˜¯æƒ…æ„Ÿçš„æ ¸å¿ƒã€‚',
                'ç…å­åº§': 'æƒ…æ„Ÿè±å¯Œä¸”æˆ²åŠ‡åŒ–ï¼Œéœ€è¦è¢«æ¬£è³èˆ‡èªå¯ã€‚',
                'è™•å¥³åº§': 'æƒ…æ„Ÿè¡¨é”è¬¹æ…ï¼Œé‡è¦–å¯¦éš›çš„é—œæ‡·èˆ‡æœå‹™ã€‚',
                'å¤©ç§¤åº§': 'è¿½æ±‚æƒ…æ„Ÿå’Œè«§ï¼Œé¿å…è¡çªèˆ‡ä¸å¹³è¡¡çš„é—œä¿‚ã€‚',
                'å¤©è åº§': 'æƒ…æ„Ÿæ·±åˆ»ä¸”éš±ç§˜ï¼Œæ“æœ‰å¼·çƒˆçš„å¿ èª èˆ‡ä½”æœ‰æ¬²ã€‚',
                'å°„æ‰‹åº§': 'æƒ…æ„Ÿè‡ªç”±å¥”æ”¾ï¼Œéœ€è¦ç©ºé–“èˆ‡å†’éšªçš„é«”é©—ã€‚',
                'æ‘©ç¾¯åº§': 'æƒ…æ„Ÿå…§æ–‚ä¸”å‹™å¯¦ï¼Œé€éæˆå°±ç²å¾—å®‰å…¨æ„Ÿã€‚',
                'æ°´ç“¶åº§': 'æƒ…æ„Ÿç¨ç«‹ä¸”è¶…è„«ï¼Œé‡è¦–å‹èª¼èˆ‡æ™ºæ€§é€£çµã€‚',
                'é›™é­šåº§': 'æƒ…æ„Ÿè±å¯Œè€Œå¤¢å¹»ï¼Œå®¹æ˜“å—ä»–äººæƒ…ç·’å½±éŸ¿ã€‚'
            },
            ascendant: {
                'ç‰¡ç¾Šåº§': 'çµ¦äººç›´æ¥å¤§è†½çš„ç¬¬ä¸€å°è±¡ï¼Œå……æ»¿æ´»åŠ›èˆ‡è¡Œå‹•åŠ›ã€‚',
                'é‡‘ç‰›åº§': 'æ•£ç™¼ç©©é‡å¯é çš„æ°£è³ªï¼Œæº«å’Œè€Œæœ‰è€å¿ƒã€‚',
                'é›™å­åº§': 'æ´»æ½‘æ©Ÿæ™ºçš„ç¤¾äº¤è€…ï¼Œç¸½æ˜¯å……æ»¿è©±é¡Œèˆ‡å¥½å¥‡ã€‚',
                'å·¨èŸ¹åº§': 'æº«æš–è¦ªåˆ‡çš„å°è±¡ï¼Œæ•£ç™¼å®¶åº­èˆ¬çš„èˆ’é©æ„Ÿã€‚',
                'ç…å­åº§': 'è‡ªä¿¡è€€çœ¼çš„å­˜åœ¨ï¼Œç¸½æ˜¯æˆç‚ºçœ¾äººç„¦é»ã€‚',
                'è™•å¥³åº§': 'æ•´æ½”ç´°å¿ƒçš„å°ˆæ¥­å½¢è±¡ï¼Œæ³¨é‡ç´°ç¯€èˆ‡æ•ˆç‡ã€‚',
                'å¤©ç§¤åº§': 'å„ªé›…è¿·äººçš„ç¤¾äº¤é«˜æ‰‹ï¼Œå’Œè«§è€Œæœ‰å“å‘³ã€‚',
                'å¤©è åº§': 'ç¥ç§˜è€Œæœ‰æ·±åº¦çš„æ°£è³ªï¼Œæ•£ç™¼å¼·çƒˆçš„å¸å¼•åŠ›ã€‚',
                'å°„æ‰‹åº§': 'æ¨‚è§€é–‹æœ—çš„å†’éšªå®¶ï¼Œå……æ»¿ç†±æƒ…èˆ‡å¹½é»˜æ„Ÿã€‚',
                'æ‘©ç¾¯åº§': 'æˆç†Ÿç©©é‡çš„å°ˆæ¥­äººå£«ï¼Œæ•£ç™¼æ¬Šå¨èˆ‡è²¬ä»»æ„Ÿã€‚',
                'æ°´ç“¶åº§': 'ç¨ç‰¹å‰è¡›çš„å€‹æ€§ï¼Œç¸½æ˜¯å¸¶ä¾†æ–°é®®çš„è§€é»ã€‚',
                'é›™é­šåº§': 'æº«æŸ”å¤¢å¹»çš„æ°£è³ªï¼Œæ•£ç™¼è—è¡“å®¶çš„æµªæ¼«æ°›åœã€‚'
            }
        };

        async function generateChart() {
            const birthDateStr = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            const birthPlace = document.getElementById('birthPlace').value;
            
            if (!birthDateStr || !birthTime || !birthPlace) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„å‡ºç”Ÿè³‡è¨Šï¼');
                return;
            }

            const results = document.getElementById('results');
            const chartGrid = document.getElementById('chartGrid');
            chartGrid.innerHTML = '<div class="loading">ğŸ”® æ­£åœ¨å¬å–šæ˜Ÿè¾°... è«‹ç¨å€™</div>';
            results.style.display = 'block';

            try {
                // æ­¥é©Ÿ1: ç²å–ç¶“ç·¯åº¦
                const geoData = await fetchGeoLocation(birthPlace);
                const lat = geoData.lat;
                const lon = geoData.lon;
                const tz = 'Asia/Taipei';  // é è¨­å°ç£ï¼Œå¯æ“´å±•

                // æ­¥é©Ÿ2: æ ¼å¼åŒ–å‡ºç”Ÿæ™‚é–“
                const birthDate = new Date(birthDateStr + 'T' + birthTime);
                const payload = {
                    day: birthDate.getDate(),
                    month: birthDate.getMonth() + 1,
                    year: birthDate.getFullYear(),
                    hour: birthDate.getHours(),
                    min: birthDate.getMinutes(),
                    lat: lat,
                    lon: lon,
                    tzone: tz
                };

                // æ­¥é©Ÿ3: å‘¼å« API
                const response = await fetch(`${API_BASE}/planets_positions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${btoa(API_KEY + ':')}`,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams(payload)
                });

                if (!response.ok) throw new Error(`API éŒ¯èª¤: ${response.status}`);
                const chartData = await response.json();

                // æå–è³‡æ–™ (å‡è¨­ API å›å‚³æ ¼å¼: { sun: { sign: 'Aries', degree: 15 }, ... } ä¾æ–‡ä»¶èª¿æ•´)
                const sunEn = chartData.sun.sign || 'Aries';
                const moonEn = chartData.moon.sign || 'Taurus';
                const ascEn = chartData.ascendant || chartData.houses[1].sign || 'Gemini';  // å‡è¨­
                const sunDegree = chartData.sun.degree || 0;
                const moonDegree = chartData.moon.degree || 0;
                const ascDegree = chartData.ascendant_degree || 0;

                const sunZh = enToZh[sunEn] || 'ç‰¡ç¾Šåº§';
                const moonZh = enToZh[moonEn] || 'é‡‘ç‰›åº§';
                const ascZh = enToZh[ascEn] || 'é›™å­åº§';

                // é¡¯ç¤ºçµæœ
                displayChart(sunZh, moonZh, ascZh, sunDegree, moonDegree, ascDegree, birthDate, birthPlace);

            } catch (error) {
                console.error('API éŒ¯èª¤ï¼š', error);
                chartGrid.innerHTML = '<div class="error">ğŸŒŸ API æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œåˆ‡æ›è‡³ç°¡åŒ–æ¨¡å¼...</div>';
                // å¾Œå‚™: ä½¿ç”¨ç°¡åŒ–ç‰ˆæœ¬
                setTimeout(() => generateSimplifiedChart(birthDateStr, birthTime, birthPlace), 2000);
            }
        }

        // å¾Œå‚™ç°¡åŒ–è¨ˆç®—
        function generateSimplifiedChart(birthDateStr, birthTime, birthPlace) {
            const birthDate = new Date(birthDateStr + 'T' + birthTime);
            const sunData = getZodiacSign(birthDate);
            const moonDate = new Date(birthDate.getTime() + (Math.random() * 2 - 1) * 24 * 60 * 60 * 1000);
            const moonData = getZodiacSign(moonDate);
            const ascDate = new Date(birthDate.getTime() + Math.random() * 24 * 60 * 60 * 1000);
            const ascData = getZodiacSign(ascDate);
            displayChart(sunData.sign, moonData.sign, ascData.sign, Math.floor(Math.random() * 30), Math.floor(Math.random() * 30), Math.floor(Math.random() * 30), birthDate, birthPlace);
        }

        function getZodiacSign(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dateStr = `${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            
            for (const [sign, range] of Object.entries(zodiacData)) {
                if (isDateInRange(dateStr, range.start, range.end)) {
                    return { sign, ...range };
                }
            }
            return zodiacData['ç‰¡ç¾Šåº§'];
        }

        function isDateInRange(dateStr, start, end) {
            const [month, day] = dateStr.split('-').map(Number);
            const [startMonth, startDay] = start.split('-').map(Number);
            const [endMonth, endDay] = end.split('-').map(Number);
            
            if (month > startMonth && month < endMonth) return true;
            if (month === startMonth && day >= startDay) return true;
            if (month === endMonth && day <= endDay) return true;
            
            if (startMonth > endMonth) {
                return month >= startMonth || month <= endMonth;
            }
            
            return false;
        }

        // ç²å–ç¶“ç·¯åº¦
        async function fetchGeoLocation(city) {
            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city + ', Taiwan')}&limit=1`);
            const data = await response.json();
            if (data.length > 0) {
                return {
                    lat: parseFloat(data[0].lat),
                    lon: parseFloat(data[0].lon),
                    timezone: 'Asia/Taipei'
                };
            }
            throw new Error('æ‰¾ä¸åˆ°åœ°é»');
        }

        function displayChart(sun, moon, asc, sunDeg, moonDeg, ascDeg, birthDate, birthPlace) {
            const chartGrid = document.getElementById('chartGrid');
            const interpretation = document.getElementById('interpretation');
            const zodiacInfo = document.getElementById('zodiacInfo');

            // ç²å–å…ƒç´ 
            const sunData = Object.values(zodiacData).find(d => d.sign === sun) || zodiacData['ç‰¡ç¾Šåº§'];
            const moonData = Object.values(zodiacData).find(d => d.sign === moon) || zodiacData['é‡‘ç‰›åº§'];
            const ascData = Object.values(zodiacData).find(d => d.sign === asc) || zodiacData['é›™å­åº§'];

            chartGrid.innerHTML = `
                <div class="planet-card sun">
                    <div class="planet-name">â˜‰ å¤ªé™½</div>
                    <div class="zodiac-sign">${sun}</div>
                    <div class="degree">${sunDeg}Â°</div>
                </div>
                <div class="planet-card moon">
                    <div class="planet-name">â˜¾ æœˆäº®</div>
                    <div class="zodiac-sign">${moon}</div>
                    <div class="degree">${moonDeg}Â°</div>
                </div>
                <div class="planet-card earth">
                    <div class="planet-name">â™ˆ ä¸Šå‡</div>
                    <div class="zodiac-sign">${asc}</div>
                    <div class="degree">${ascDeg}Â°</div>
                </div>
            `;

            interpretation.innerHTML = `
                <h3>ğŸŒŸ å‘½ç›¤è§£è®€</h3>
                <p><strong>å‡ºç”Ÿè³‡è¨Šï¼š</strong>${birthDate.toLocaleDateString('zh-TW')} ${birthDate.toLocaleTimeString('zh-TW', {hour12: false})} (${birthPlace})</p>
                
                <h4>â˜‰ å¤ªé™½ ${sun}</h4>
                <p>${planetInterpretations.sun[sun] || 'å¤ªé™½ä»£è¡¨ä½ çš„æ ¸å¿ƒè‡ªæˆ‘èˆ‡ç”Ÿå‘½èƒ½é‡ã€‚'}</p>
                
                <h4>â˜¾ æœˆäº® ${moon}</h4>
                <p>${planetInterpretations.moon[moon] || 'æœˆäº®ä»£è¡¨ä½ çš„æƒ…æ„Ÿéœ€æ±‚èˆ‡å…§åœ¨ä¸–ç•Œã€‚'}</p>
                
                <h4>â™ˆ ä¸Šå‡ ${asc}</h4>
                <p>${planetInterpretations.ascendant[asc] || 'ä¸Šå‡ä»£è¡¨ä½ çš„å¤–åœ¨å½¢è±¡èˆ‡ç¬¬ä¸€å°è±¡ã€‚'}</p>
            `;

            zodiacInfo.innerHTML = `
                <div class="zodiac-card">
                    <h4>${sun} ç‰¹è³ª</h4>
                    <p><strong>å…ƒç´ ï¼š</strong>${sunData.element} | <strong>ç‰¹è³ªï¼š</strong>${sunData.quality}</p>
                    <p><strong>æ€§æ ¼ï¼š</strong>${getZodiacTraits(sun)}</p>
                </div>
                <div class="zodiac-card">
                    <h4>${moon} æƒ…æ„Ÿ</h4>
                    <p><strong>å…ƒç´ ï¼š</strong>${moonData.element} | <strong>ç‰¹è³ªï¼š</strong>${moonData.quality}</p>
                    <p><strong>éœ€æ±‚ï¼š</strong>${getEmotionalNeeds(moon)}</p>
                </div>
                <div class="zodiac-card">
                    <h4>${asc} å¤–åœ¨</h4>
                    <p><strong>å…ƒç´ ï¼š</strong>${ascData.element} | <strong>ç‰¹è³ªï¼š</strong>${ascData.quality}</p>
                    <p><strong>å°è±¡ï¼š</strong>${getFirstImpression(asc)}</p>
                </div>
            `;
        }

        // å…¶é¤˜è¼”åŠ©å‡½æ•¸ä¿æŒåŸæ¨£
        function getZodiacTraits(sign) {
            const traits = {
                'ç‰¡ç¾Šåº§': 'å‹‡æ•¢ã€ç›´æ¥ã€ç†±æƒ…ã€é–‹å‰µ',
                'é‡‘ç‰›åº§': 'ç©©é‡ã€è€å¿ƒã€å¯¦éš›ã€äº«å—',
                'é›™å­åº§': 'æ©Ÿæ™ºã€éˆæ´»ã€å¥½å¥‡ã€å–„è®Š',
                'å·¨èŸ¹åº§': 'æ•æ„Ÿã€ä¿è­·ã€æº«æš–ã€æƒ…æ„Ÿ',
                'ç…å­åº§': 'è‡ªä¿¡ã€ç†±æƒ…ã€é ˜å°ã€å‰µæ„',
                'è™•å¥³åº§': 'ç´°å¿ƒã€è¬¹æ…ã€åˆ†æã€å®Œç¾',
                'å¤©ç§¤åº§': 'å„ªé›…ã€å’Œè«§ã€ç¤¾äº¤ã€å…¬æ­£',
                'å¤©è åº§': 'æ·±æ²‰ã€ç¥ç§˜ã€å …éŸŒã€æ´å¯Ÿ',
                'å°„æ‰‹åº§': 'æ¨‚è§€ã€å†’éšªã€è‡ªç”±ã€ç›´ç‡',
                'æ‘©ç¾¯åº§': 'å‹™å¯¦ã€ç´€å¾‹ã€é‡å¿ƒã€è²¬ä»»',
                'æ°´ç“¶åº§': 'å‰µæ–°ã€ç¨ç«‹ã€ç†æƒ³ã€äººé“',
                'é›™é­šåº§': 'å¤¢å¹»ã€æ•æ„Ÿã€ç›´è¦ºã€åŒç†'
            };
            return traits[sign] || 'ç¨ç‰¹è€Œè¿·äºº';
        }

        function getEmotionalNeeds(sign) {
            const needs = {
                'ç‰¡ç¾Šåº§': 'è¢«é¼“å‹µå±•ç¾è‡ªæˆ‘ï¼Œéœ€è¦è¡Œå‹•çš„ç©ºé–“',
                'é‡‘ç‰›åº§': 'ç©©å®šç’°å¢ƒèˆ‡æ„Ÿå®˜äº«å—çš„å®‰å…¨æ„Ÿ',
                'é›™å­åº§': 'æ™ºåŠ›åˆºæ¿€èˆ‡å¤šå…ƒçš„ç¤¾äº¤äº¤æµ',
                'å·¨èŸ¹åº§': 'å®¶åº­æº«æš–èˆ‡æƒ…æ„Ÿä¸Šçš„æ­¸å±¬æ„Ÿ',
                'ç…å­åº§': 'è¢«æ¬£è³èˆ‡èªå¯çš„èˆå°è¡¨ç¾',
                'è™•å¥³åº§': 'æœ‰ç§©åºçš„ç’°å¢ƒèˆ‡å¯¦éš›çš„å¹«åŠ©',
                'å¤©ç§¤åº§': 'å’Œè«§é—œä¿‚èˆ‡ç¾æ„Ÿç’°å¢ƒçš„å¹³è¡¡',
                'å¤©è åº§': 'æ·±å±¤çš„ä¿¡ä»»èˆ‡æƒ…æ„Ÿçš„æ·±åˆ»é€£çµ',
                'å°„æ‰‹åº§': 'è‡ªç”±ç©ºé–“èˆ‡å†’éšªæ¢ç´¢çš„æ©Ÿæœƒ',
                'æ‘©ç¾¯åº§': 'æˆå°±æ„Ÿèˆ‡é•·æœŸç›®æ¨™çš„å¯¦ç¾',
                'æ°´ç“¶åº§': 'æ™ºæ€§å‹èª¼èˆ‡ç¨ç«‹çš„å€‹äººç©ºé–“',
                'é›™é­šåº§': 'æµªæ¼«æ°›åœèˆ‡éˆé­‚å±¤é¢çš„ç†è§£'
            };
            return needs[sign] || 'è¢«ç†è§£èˆ‡æ¥ç´';
        }

        function getFirstImpression(sign) {
            const impressions = {
                'ç‰¡ç¾Šåº§': 'å……æ»¿æ´»åŠ›èˆ‡è¡Œå‹•åŠ›çš„é ˜è¢–æ°£è³ª',
                'é‡‘ç‰›åº§': 'ç©©é‡å¯é çš„å€¼å¾—ä¿¡è³´å½¢è±¡',
                'é›™å­åº§': 'æ©Ÿæ™ºå¹½é»˜çš„ç¤¾äº¤é”äººæ°£å ´',
                'å·¨èŸ¹åº§': 'æº«æš–è¦ªåˆ‡å¦‚å®¶äººèˆ¬çš„æ„Ÿè¦º',
                'ç…å­åº§': 'è‡ªä¿¡è€€çœ¼ä»¤äººç„¡æ³•å¿½è¦–çš„å­˜åœ¨',
                'è™•å¥³åº§': 'å°ˆæ¥­ç´°å¿ƒå€¼å¾—ä¿¡è³´çš„å°ˆå®¶',
                'å¤©ç§¤åº§': 'å„ªé›…è¿·äººå¦‚è—è¡“å“èˆ¬çš„æ°£è³ª',
                'å¤©è åº§': 'ç¥ç§˜æ·±æ²‰å……æ»¿å¸å¼•åŠ›çš„æ°£å ´',
                'å°„æ‰‹åº§': 'æ¨‚è§€é–‹æœ—å¦‚é™½å…‰èˆ¬çš„è¦ªå’ŒåŠ›',
                'æ‘©ç¾¯åº§': 'æˆç†Ÿç©©é‡å……æ»¿è²¬ä»»æ„Ÿçš„å°ˆæ¥­æ„Ÿ',
                'æ°´ç“¶åº§': 'ç¨ç‰¹å‰è¡›å……æ»¿æ–°æ„çš„å€‹æ€§',
                'é›™é­šåº§': 'æº«æŸ”å¤¢å¹»å¦‚è©©äººèˆ¬çš„æµªæ¼«æ°£è³ª'
            };
            return impressions[sign] || 'ç¨ç‰¹è€Œé›£å¿˜çš„ç¬¬ä¸€å°è±¡';
        }

        // é è¨­æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const hours = String(today.getHours()).padStart(2, '0');
            const minutes = String(today.getMinutes()).padStart(2, '0');
            
            document.getElementById('birthDate').value = `${year}-${month}-${day}`;
            document.getElementById('birthTime').value = `${hours}:${minutes}`;
        });
    </script>
</body>
</html>
