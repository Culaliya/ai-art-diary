<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字命理館 - 星空占卜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(to bottom, #0a0e27 0%, #1a1a3e 50%, #2d1b4e 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 星空背景 */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* 流星效果 */
        .shooting-star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            animation: shoot 3s linear infinite;
            opacity: 0;
        }

        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-300px) translateY(300px);
                opacity: 0;
            }
        }

        /* 主容器 */
        .container {
            position: relative;
            z-index: 2;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* 頭部 */
        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 1s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 3em;
            color: #fff;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8),
                         0 0 40px rgba(138, 43, 226, 0.5);
            margin-bottom: 10px;
            letter-spacing: 5px;
        }

        .subtitle {
            color: #b8b8d4;
            font-size: 1.2em;
            letter-spacing: 3px;
        }

        /* 卡片容器 */
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-out 0.3s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            color: #e0e0ff;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        select option {
            background: #fff;
            color: #000;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* 時間選擇器網格 */
        .time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        /* 按鈕 */
        button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 2px;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(-1px);
        }

        /* 結果顯示區域 */
        .result-section {
            margin-top: 40px;
            padding: 30px;
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            display: none;
        }

        .result-section.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .bazi-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .pillar {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pillar-title {
            color: #ffd700;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .pillar-char {
            font-size: 2em;
            color: #fff;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .element {
            color: #b8b8d4;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .interpretation {
            color: #e0e0ff;
            line-height: 1.8;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .interpretation h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .interpretation p {
            margin-bottom: 15px;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .card {
                padding: 25px;
            }

            .bazi-display {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 返回首頁按鈕 */
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
            z-index: 1000;
            width: auto;
            margin: 0;
            display: inline-block;
            font-size: 1em;
        }

        .home-button:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- 星空背景 -->
    <div class="stars" id="stars"></div>
    
    <!-- 返回首頁按鈕 -->
    <a href="index.html" class="home-button">🏠 首頁</a>

    <div class="container">
        <header>
            <h1>✨ 八字命理館 ✨</h1>
            <p class="subtitle">探索命運的奧秘</p>
        </header>

        <div class="card">
            <form id="baziForm">
                <div class="form-group">
                    <label for="name">您的姓名</label>
                    <input type="text" id="name" name="name" placeholder="請輸入您的姓名" required>
                </div>

                <div class="form-group">
                    <label for="gender">性別</label>
                    <select id="gender" name="gender" required>
                        <option value="">請選擇</option>
                        <option value="male">男</option>
                        <option value="female">女</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="birthdate">出生日期</label>
                    <input type="date" id="birthdate" name="birthdate" required>
                </div>

                <div class="form-group">
                    <label>出生時間</label>
                    <div class="time-grid">
                        <select id="hour" name="hour" required>
                            <option value="">時</option>
                        </select>
                        <select id="minute" name="minute" required>
                            <option value="">分</option>
                        </select>
                        <select id="second" name="second">
                            <option value="0">秒</option>
                        </select>
                    </div>
                </div>

                <button type="submit">🔮 開始算命</button>
            </form>

            <div class="result-section" id="resultSection">
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 30px;">您的八字命盤</h2>
                
                <div class="bazi-display" id="baziDisplay">
                    <!-- 八字四柱將動態生成 -->
                </div>

                <div class="interpretation" id="interpretation">
                    <!-- 解讀內容將動態生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 生成星空
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numberOfStars = 200;

            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }

            // 創建流星
            for (let i = 0; i < 3; i++) {
                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                shootingStar.style.left = Math.random() * 100 + '%';
                shootingStar.style.top = Math.random() * 50 + '%';
                shootingStar.style.animationDelay = Math.random() * 5 + 's';
                starsContainer.appendChild(shootingStar);
            }
        }

        // 初始化時間選擇器
        function initTimeSelectors() {
            const hourSelect = document.getElementById('hour');
            const minuteSelect = document.getElementById('minute');
            const secondSelect = document.getElementById('second');

            for (let i = 0; i < 24; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i.toString().padStart(2, '0');
                hourSelect.appendChild(option);
            }

            for (let i = 0; i < 60; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i.toString().padStart(2, '0');
                minuteSelect.appendChild(option);
            }

            for (let i = 0; i < 60; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i.toString().padStart(2, '0');
                secondSelect.appendChild(option);
            }
        }

        // 天干地支
        const heavenlyStems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const earthlyBranches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const elements = ['木', '木', '火', '火', '土', '土', '金', '金', '水', '水'];
        const branchElements = ['水', '土', '木', '木', '土', '火', '火', '土', '金', '金', '土', '水'];
        
        // 時辰對應表（23-1點為子時）
        const hourBranches = ['子', '丑', '丑', '寅', '寅', '卯', '卯', '辰', '辰', '巳', '巳', '午', 
                             '午', '未', '未', '申', '申', '酉', '酉', '戌', '戌', '亥', '亥', '子'];

        // 計算從基準日期到目標日期的天數
        function getDaysSinceEpoch(date) {
            const baseDate = new Date(1900, 0, 31); // 1900年1月31日為庚子日
            const diff = date - baseDate;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        // 計算八字
        function calculateBazi(birthDate) {
            const year = birthDate.getFullYear();
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();
            const hour = birthDate.getHours();

            // 年柱計算（以立春為界）
            let yearOffset = year - 4; // 甲子年開始於公元4年
            const yearStemIndex = yearOffset % 10;
            const yearBranchIndex = yearOffset % 12;
            const yearStem = heavenlyStems[yearStemIndex];
            const yearBranch = earthlyBranches[yearBranchIndex];
            
            // 月柱計算（根據年干推算月干）
            // 月支固定：寅月(立春-驚蟄)、卯月(驚蟄-清明)等
            // 簡化處理：1月=寅，2月=卯...12月=丑
            let monthBranchIndex = (month + 1) % 12; // 1月對應寅(2)
            if (monthBranchIndex === 0) monthBranchIndex = 1; // 12月對應丑(1)
            
            // 月干根據年干推算（五虎遁月口訣）
            // 甲己之年丙作首，乙庚之年戊為頭
            // 丙辛必定尋庚起，丁壬壬位順行流
            // 若問戊癸何方發，甲寅之上好追求
            const monthStemStart = [2, 4, 6, 8, 0]; // 丙、戊、庚、壬、甲
            const yearStemMod = yearStemIndex % 5;
            const monthStemIndex = (monthStemStart[yearStemMod] + month - 1) % 10;
            
            const monthStem = heavenlyStems[monthStemIndex];
            const monthBranch = earthlyBranches[monthBranchIndex];
            
            // 日柱計算（使用萬年曆推算）
            const daysSinceEpoch = getDaysSinceEpoch(birthDate);
            const dayStemIndex = (daysSinceEpoch + 6) % 10; // 基準日1900/1/31是庚(6)子日
            const dayBranchIndex = (daysSinceEpoch + 0) % 12; // 基準日是子(0)
            const dayStem = heavenlyStems[dayStemIndex];
            const dayBranch = earthlyBranches[dayBranchIndex];
            
            // 時柱計算
            const hourBranchIndex = Math.floor((hour + 1) % 24 / 2); // 23-1點為子時(0)
            const hourBranch = earthlyBranches[hourBranchIndex];
            
            // 時干根據日干推算（五鼠遁時口訣）
            // 甲己還加甲，乙庚丙作初
            // 丙辛從戊起，丁壬庚子居
            // 戊癸何方發，壬子是真途
            const hourStemStart = [0, 2, 4, 6, 8]; // 甲、丙、戊、庚、壬
            const dayStemMod = dayStemIndex % 5;
            const hourStemIndex = (hourStemStart[dayStemMod] + hourBranchIndex) % 10;
            const hourStem = heavenlyStems[hourStemIndex];

            return {
                year: { stem: yearStem, branch: yearBranch },
                month: { stem: monthStem, branch: monthBranch },
                day: { stem: dayStem, branch: dayBranch },
                hour: { stem: hourStem, branch: hourBranch }
            };
        }

        // 顯示八字結果
        function displayBazi(bazi, name, gender) {
            const baziDisplay = document.getElementById('baziDisplay');
            const interpretation = document.getElementById('interpretation');
            
            baziDisplay.innerHTML = `
                <div class="pillar">
                    <div class="pillar-title">年柱</div>
                    <div class="pillar-char">${bazi.year.stem}</div>
                    <div class="pillar-char">${bazi.year.branch}</div>
                    <div class="element">${elements[heavenlyStems.indexOf(bazi.year.stem)]}/${branchElements[earthlyBranches.indexOf(bazi.year.branch)]}</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">月柱</div>
                    <div class="pillar-char">${bazi.month.stem}</div>
                    <div class="pillar-char">${bazi.month.branch}</div>
                    <div class="element">${elements[heavenlyStems.indexOf(bazi.month.stem)]}/${branchElements[earthlyBranches.indexOf(bazi.month.branch)]}</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">日柱</div>
                    <div class="pillar-char">${bazi.day.stem}</div>
                    <div class="pillar-char">${bazi.day.branch}</div>
                    <div class="element">${elements[heavenlyStems.indexOf(bazi.day.stem)]}/${branchElements[earthlyBranches.indexOf(bazi.day.branch)]}</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">時柱</div>
                    <div class="pillar-char">${bazi.hour.stem}</div>
                    <div class="pillar-char">${bazi.hour.branch}</div>
                    <div class="element">${elements[heavenlyStems.indexOf(bazi.hour.stem)]}/${branchElements[earthlyBranches.indexOf(bazi.hour.branch)]}</div>
                </div>
            `;

            const dayElement = elements[heavenlyStems.indexOf(bazi.day.stem)];
            const genderText = gender === 'male' ? '先生' : '女士';

            interpretation.innerHTML = `
                <h3>✨ ${name}${genderText}的命理解析</h3>
                <p><strong>日主五行：</strong>${dayElement}</p>
                <p><strong>性格特質：</strong>${getPersonalityByElement(dayElement)}</p>
                <p><strong>事業運勢：</strong>${getCareerByElement(dayElement)}</p>
                <p><strong>財運分析：</strong>${getWealthByElement(dayElement)}</p>
                <p><strong>感情運勢：</strong>${getLoveByElement(dayElement)}</p>
                <p style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2); color: #ffd700;">
                    ⭐ 命理建議：保持積極樂觀的心態，順應自然規律，方能趨吉避凶，開創美好未來。
                </p>
            `;

            document.getElementById('resultSection').classList.add('show');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        // 根據五行獲取性格描述
        function getPersonalityByElement(element) {
            const personalities = {
                '木': '性格仁慈正直，富有同情心，具有向上發展的特性，為人正直善良，待人和藹可親。',
                '火': '性格熱情積極，具有禮貌修養，善於社交，富有進取精神和領導才能。',
                '土': '性格穩重踏實，誠實守信，具有包容心，為人忠厚老實，值得信賴。',
                '金': '性格剛毅果斷，講究義氣，有正義感，做事認真負責，意志堅定。',
                '水': '性格聰明靈活，富有智慧，善於思考，適應能力強，具有創新精神。'
            };
            return personalities[element] || '性格特質待分析';
        }

        // 根據五行獲取事業描述
        function getCareerByElement(element) {
            const careers = {
                '木': '適合從事教育、文化、藝術、園林、醫療等行業，事業發展穩健向上。',
                '火': '適合從事傳媒、藝術、表演、科技、管理等行業，事業容易有突破性發展。',
                '土': '適合從事房地產、建築、農業、中介、顧問等行業，事業根基穩固。',
                '金': '適合從事金融、法律、軍警、機械、工程等行業，事業講求精準和效率。',
                '水': '適合從事貿易、物流、旅遊、水產、信息等行業，事業發展靈活多變。'
            };
            return careers[element] || '事業運勢待分析';
        }

        // 根據五行獲取財運描述
        function getWealthByElement(element) {
            const wealth = {
                '木': '財運穩健，適合長期投資，財富積累如樹木生長般循序漸進。',
                '火': '財運旺盛，偏財運較好，但需注意理財規劃，避免大起大落。',
                '土': '財運穩定，善於積累財富，適合穩健型投資，財富根基深厚。',
                '金': '財運不錯，正財為主，通過努力工作可獲得豐厚回報。',
                '水': '財運靈活，財路較廣，適合多元化投資，把握機遇能有不錯收益。'
            };
            return wealth[element] || '財運分析待解讀';
        }

        // 根據五行獲取感情描述
        function getLoveByElement(element) {
            const love = {
                '木': '感情真摯，對愛情忠誠專一，適合細水長流的感情模式。',
                '火': '感情熱烈，充滿激情，但需注意情緒管理，維持感情的穩定性。',
                '土': '感情穩重，重視家庭，是值得依靠的伴侶，婚姻生活安穩幸福。',
                '金': '感情專一，重視承諾，對感情認真負責，是可靠的終身伴侶。',
                '水': '感情細膩，善解人意，溝通能力強，能營造和諧的感情氛圍。'
            };
            return love[element] || '感情運勢待分析';
        }

        // 表單提交處理
        document.getElementById('baziForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const gender = document.getElementById('gender').value;
            const birthdate = document.getElementById('birthdate').value;
            const hour = document.getElementById('hour').value;
            const minute = document.getElementById('minute').value;
            
            const birthDate = new Date(birthdate);
            birthDate.setHours(parseInt(hour), parseInt(minute), 0);
            
            const bazi = calculateBazi(birthDate);
            displayBazi(bazi, name, gender);
        });

        // 頁面加載時初始化
        window.addEventListener('load', function() {
            createStars();
            initTimeSelectors();
        });
    </script>
</body>
</html>
