<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🐈 Disaster Kitten v1.1</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden;}
  canvas {
  display: block;
  background: linear-gradient(#030416,#0c0d1a,#090a12);
  margin: auto;
  aspect-ratio: 2 / 3;     /* 維持比例 */
  max-height: 100vh;       /* 不超過螢幕高 */
  max-width: 100vw;        /* 不超過螢幕寬 */
  image-rendering: pixelated; /* 防止模糊 (像素風會更清晰) */
}

  #backHome{
    position:fixed;top:10px;left:10px;
    background:rgba(0,255,255,0.1);
    border:1px solid #0ff;color:#0ff;
    padding:8px 14px;border-radius:8px;
    font-family:sans-serif;font-weight:600;
    cursor:pointer;z-index:10;
    transition:0.3s;
  }
  #backHome:hover{background:rgba(0,255,255,0.3);}
</style>
</head>
<body>
<canvas id="game"></canvas>
<a id="backHome" href="index.html">🏠 回首頁</a>

<audio id="jumpSound" src="music/jump.mp3"></audio>
<audio id="eatSound" src="music/eat.mp3"></audio>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=480;canvas.height=720;
  // 提高清晰度
const scale = window.devicePixelRatio || 1;
canvas.width = 480 * scale;
canvas.height = 720 * scale;
ctx.scale(scale, scale);


let catImg=new Image();
catImg.src="assets/blackcat.png";

// 遊戲元素
let cat={x:220,y:600,vx:0,vy:0,w:60,h:60,onGround:false};
let keys={};
let fishes=[];
let platforms=[
  {x:0,y:660,w:480,h:60},
  {x:100,y:500,w:100,h:15},
  {x:300,y:400,w:120,h:15},
  {x:150,y:300,w:80,h:15}
];
let score=0;

function spawnFish(){
  fishes.push({
    x:Math.random()*400+30,
    y:Math.random()*300+100,
    r:12,alpha:1
  });
}
for(let i=0;i<3;i++)spawnFish();

document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

function update(){
  // 控制
  if(keys["ArrowLeft"]) cat.vx=-3;
  else if(keys["ArrowRight"]) cat.vx=3;
  else cat.vx=0;
  if(keys["Space"]&&cat.onGround){
    cat.vy=-9;
    cat.onGround=false;
    document.getElementById("jumpSound").play();
  }

  // 物理
  cat.vy+=0.5;
  cat.y+=cat.vy; cat.x+=cat.vx;

  // 平台碰撞
  cat.onGround=false;
  for(let p of platforms){
    if(cat.x+cat.w>p.x && cat.x<p.x+p.w && cat.y+cat.h>=p.y && cat.y+cat.h<=p.y+20 && cat.vy>=0){
      cat.y=p.y-cat.h;
      cat.vy=0;
      cat.onGround=true;
    }
  }
  if(cat.x<0)cat.x=0;if(cat.x+cat.w>canvas.width)cat.x=canvas.width-cat.w;
  if(cat.y>canvas.height){cat.y=600;cat.vy=0;score=Math.max(0,score-1);} // 掉下去扣分

  // 魚閃爍
  for(let f of fishes) f.alpha=Math.sin(Date.now()/200+f.x)*0.5+0.5;

  // 撞魚
  for(let f of fishes){
    if(Math.abs(cat.x+cat.w/2 - f.x)<30 && Math.abs(cat.y+cat.h/2 - f.y)<30){
      document.getElementById("eatSound").play();
      score++;
      f.x=Math.random()*400+30;
      f.y=Math.random()*300+100;
    }
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 星星背景
  ctx.fillStyle="#0ff2";
  for(let i=0;i<40;i++){
    let sx=Math.sin(i*13.3+Date.now()/800)*240+240;
    let sy=(i*37+Date.now()/20)%720;
    ctx.fillRect(sx,sy,2,2);
  }

  // 平台
  ctx.fillStyle="#222";
  for(let p of platforms) ctx.fillRect(p.x,p.y,p.w,p.h);

  // 魚
  for(let f of fishes){
    ctx.fillStyle=`rgba(255,122,182,${f.alpha})`;
    ctx.beginPath();
    ctx.ellipse(f.x,f.y,12,8,0,0,Math.PI*2);
    ctx.fill();
  }

  // 貓
  if(catImg.complete) ctx.drawImage(catImg,cat.x,cat.y,cat.w,cat.h);
  else {ctx.fillStyle="#0ff";ctx.fillRect(cat.x,cat.y,cat.w,cat.h);}

  // 分數
  ctx.fillStyle="#0ff";
  ctx.font="20px Orbitron, monospace";
  ctx.fillText("Score: "+score,20,30);
  ctx.fillText("← → 移動, 空白鍵跳",20,55);
}

function loop(){
  update();draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
