<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üêà Disaster Kitten v1.5</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden;}
  canvas{
    display:block;
    background:radial-gradient(circle at 50% 20%, #0e0f1a 0%, #080910 70%, #000 100%);
    margin:auto;
    aspect-ratio:2/3;
    max-height:100vh;
    max-width:100vw;
  }
  #backHome{
    position:fixed;top:10px;left:10px;
    background:rgba(0,255,255,0.1);
    border:1px solid #0ff;color:#0ff;
    padding:8px 14px;border-radius:8px;
    font-family:sans-serif;font-weight:600;
    cursor:pointer;z-index:10;transition:.3s;
  }
  #backHome:hover{background:rgba(0,255,255,0.3);}
  
  /* ÊâãÊ©üËôõÊì¨ÊåâÈàï */
  #mobileControls{
    display:none;
    position:fixed;
    bottom:20px;
    left:0;
    right:0;
    justify-content:space-between;
    padding:0 30px;
    pointer-events:none;
    z-index:100;
  }
  #mobileControls.active{display:flex;}
  
  .direction-pad{
    display:flex;
    gap:15px;
    pointer-events:all;
  }
  
  .mobile-btn{
    width:70px;
    height:70px;
    background:rgba(0,255,255,0.15);
    border:3px solid rgba(0,255,255,0.6);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    user-select:none;
    -webkit-user-select:none;
    touch-action:none;
    cursor:pointer;
    transition:all 0.1s;
    backdrop-filter:blur(10px);
    box-shadow:0 0 20px rgba(0,255,255,0.3);
  }
  
  .mobile-btn:active{
    background:rgba(0,255,255,0.4);
    transform:scale(0.92);
    box-shadow:0 0 30px rgba(0,255,255,0.6);
  }
  
  .jump-btn{
    pointer-events:all;
    width:80px;
    height:80px;
    background:rgba(255,182,233,0.2);
    border:3px solid rgba(255,107,198,0.7);
    box-shadow:0 0 20px rgba(255,107,198,0.4);
  }
  
  .jump-btn:active{
    background:rgba(255,182,233,0.5);
    box-shadow:0 0 30px rgba(255,107,198,0.8);
  }
  
  @media (max-width:768px){
    #mobileControls{display:flex;}
    #backHome{font-size:12px;padding:6px 10px;}
  }
  
  @media (max-width:480px){
    .mobile-btn{width:60px;height:60px;font-size:24px;}
    .jump-btn{width:70px;height:70px;}
    #mobileControls{padding:0 15px;bottom:15px;}
    .direction-pad{gap:10px;}
  }
  
  #loading{
    position:fixed;inset:0;background:#000;
    color:#0ff;font-family:'Orbitron',sans-serif;
    display:flex;align-items:center;justify-content:center;
    flex-direction:column;gap:10px;z-index:9999;
    font-size:24px;
    animation:fadeOut 0.6s ease-out forwards;
    animation-delay:1.8s;
  }
  #paw{
    font-size:40px;animation:paw 0.8s infinite alternate;
  }
  @keyframes paw{to{transform:translateY(-8px);}}
  @keyframes fadeOut{to{opacity:0;visibility:hidden;}}
</style>
</head>
<body>
<div id="loading">Loading...<div id="paw">üêæ</div></div>
<canvas id="game"></canvas>
<button id="backHome" onclick="window.history.back()">üè† ÂõûÈ¶ñÈ†Å</button>

<!-- ÊâãÊ©üËß∏ÊéßÊéßÂà∂ -->
<div id="mobileControls" class="mobile-controls">
  <div class="direction-pad">
    <div class="mobile-btn" id="leftBtn">‚¨ÖÔ∏è</div>
    <div class="mobile-btn" id="rightBtn">‚û°Ô∏è</div>
  </div>
  <div class="mobile-btn jump-btn" id="jumpBtn">‚¨ÜÔ∏è</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const scale=window.devicePixelRatio||1;
canvas.width=480*scale;canvas.height=720*scale;ctx.scale(scale,scale);

const mobileControls=document.getElementById("mobileControls");
const leftBtn=document.getElementById("leftBtn");
const rightBtn=document.getElementById("rightBtn");
const jumpBtn=document.getElementById("jumpBtn");

// üêà Ë≤ìÂí™ÂúñÁâáÔºà‰ΩøÁî®Â§ñÈÉ®ÂúñÁâáÔºâ
let catImg = new Image();
catImg.src = "assets/blackcat.png";
let catImgLoaded = false;
catImg.onload = () => { catImgLoaded = true; };
catImg.onerror = () => { 
  console.log("Ë≤ìÂí™ÂúñÁâáËºâÂÖ•Â§±ÊïóÔºå‰ΩøÁî®È†êË®≠ÂúñÂΩ¢");
  catImgLoaded = false; 
};

// üêü Áî® Canvas Áπ™Ë£ΩÈ≠öÂúñÂÉè
function drawFishImage() {
  const fishCanvas = document.createElement('canvas');
  fishCanvas.width = 30;
  fishCanvas.height = 20;
  const fishCtx = fishCanvas.getContext('2d');
  
  fishCtx.fillStyle = '#ff7ab6';
  fishCtx.beginPath();
  fishCtx.ellipse(15, 10, 10, 6, 0, 0, Math.PI * 2);
  fishCtx.fill();
  
  fishCtx.beginPath();
  fishCtx.moveTo(5, 10);
  fishCtx.lineTo(0, 5);
  fishCtx.lineTo(0, 15);
  fishCtx.closePath();
  fishCtx.fill();
  
  fishCtx.beginPath();
  fishCtx.moveTo(15, 4);
  fishCtx.lineTo(12, 0);
  fishCtx.lineTo(18, 6);
  fishCtx.closePath();
  fishCtx.fill();
  
  fishCtx.fillStyle = '#fff';
  fishCtx.beginPath();
  fishCtx.arc(20, 9, 2, 0, Math.PI * 2);
  fishCtx.fill();
  
  fishCtx.fillStyle = '#000';
  fishCtx.beginPath();
  fishCtx.arc(20, 9, 1, 0, Math.PI * 2);
  fishCtx.fill();
  
  return fishCanvas;
}

// ‚ú® Áî® Canvas Áπ™Ë£ΩÂÖâÊïà
function drawSparkleImage() {
  const sparkleCanvas = document.createElement('canvas');
  sparkleCanvas.width = 80;
  sparkleCanvas.height = 80;
  const sparkleCtx = sparkleCanvas.getContext('2d');
  
  const gradient = sparkleCtx.createRadialGradient(40, 40, 0, 40, 40, 40);
  gradient.addColorStop(0, 'rgba(0, 255, 255, 0.5)');
  gradient.addColorStop(0.5, 'rgba(0, 255, 255, 0.2)');
  gradient.addColorStop(1, 'rgba(0, 255, 255, 0)');
  
  sparkleCtx.fillStyle = gradient;
  sparkleCtx.fillRect(0, 0, 80, 80);
  
  sparkleCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
  sparkleCtx.beginPath();
  for(let i = 0; i < 8; i++) {
    const angle = (i * Math.PI) / 4;
    const x = 40 + Math.cos(angle) * 25;
    const y = 40 + Math.sin(angle) * 25;
    sparkleCtx.arc(x, y, 2, 0, Math.PI * 2);
  }
  sparkleCtx.fill();
  
  return sparkleCanvas;
}

let fishImg = drawFishImage();
let sparkle = drawSparkleImage();

let gameOver=false,loaded=true;
let cat={x:210,y:580,vx:0,vy:0,w:60,h:60,onGround:false,glow:0};
let keys={},score=0;

let platforms=[
  {x:0,y:660,w:480,h:60},
  {x:120,y:580,w:120,h:15},
  {x:280,y:510,w:120,h:15},
  {x:150,y:440,w:120,h:15},
  {x:80,y:370,w:100,h:15},
  {x:300,y:300,w:120,h:15}
];

let fishes=[];

function spawnFish(){
  if(fishes.length>=5)return;
  fishes.push({
    x:Math.random()*420+30,
    y:Math.random()*350+100,
    vx:(Math.random()-0.5)*1.5,
    vy:(Math.random()-0.5)*1.5,
    life:600
  });
}

for(let i=0;i<3;i++)spawnFish();

let effects=[];
function addEffect(x,y){effects.push({x,y,alpha:1});}

// ÈçµÁõ§ÊéßÂà∂
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

// ÊâãÊ©üËß∏ÊéßÊéßÂà∂
function handleTouchStart(e, keyCode) {
  e.preventDefault();
  keys[keyCode] = true;
}

function handleTouchEnd(e, keyCode) {
  e.preventDefault();
  keys[keyCode] = false;
}

// Â∑¶ÊåâÈàï
leftBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'ArrowLeft'));
leftBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'ArrowLeft'));
leftBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'ArrowLeft'));

// Âè≥ÊåâÈàï
rightBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'ArrowRight'));
rightBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'ArrowRight'));
rightBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'ArrowRight'));

// Ë∑≥Ë∫çÊåâÈàï
jumpBtn.addEventListener('touchstart', (e) => handleTouchStart(e, 'Space'));
jumpBtn.addEventListener('touchend', (e) => handleTouchEnd(e, 'Space'));
jumpBtn.addEventListener('touchcancel', (e) => handleTouchEnd(e, 'Space'));

// ÊªëÈº†ÊîØÊè¥ÔºàÊñπ‰æøÈõªËÖ¶Ê∏¨Ë©¶Ôºâ
leftBtn.addEventListener('mousedown', (e) => handleTouchStart(e, 'ArrowLeft'));
leftBtn.addEventListener('mouseup', (e) => handleTouchEnd(e, 'ArrowLeft'));
leftBtn.addEventListener('mouseleave', (e) => handleTouchEnd(e, 'ArrowLeft'));

rightBtn.addEventListener('mousedown', (e) => handleTouchStart(e, 'ArrowRight'));
rightBtn.addEventListener('mouseup', (e) => handleTouchEnd(e, 'ArrowRight'));
rightBtn.addEventListener('mouseleave', (e) => handleTouchEnd(e, 'ArrowRight'));

jumpBtn.addEventListener('mousedown', (e) => handleTouchStart(e, 'Space'));
jumpBtn.addEventListener('mouseup', (e) => handleTouchEnd(e, 'Space'));
jumpBtn.addEventListener('mouseleave', (e) => handleTouchEnd(e, 'Space'));

// üéµ Á∞°ÊòìÈü≥ÊïàÁîüÊàê
function playJumpSound() {
  try {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.1);
    
    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    
    oscillator.start(audioCtx.currentTime);
    oscillator.stop(audioCtx.currentTime + 0.1);
  } catch(e) {}
}

function playEatSound() {
  try {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.05);
    
    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    
    oscillator.start(audioCtx.currentTime);
    oscillator.stop(audioCtx.currentTime + 0.1);
  } catch(e) {}
}

function update(){
  if(!loaded)return;
  
  if(keys["ArrowLeft"]) cat.vx=-3;
  else if(keys["ArrowRight"]) cat.vx=3;
  else cat.vx=0;
  
  if(keys["Space"]&&cat.onGround){
    cat.vy=-10;
    cat.onGround=false;
    playJumpSound();
  }

  cat.vy+=0.5;
  cat.y+=cat.vy;
  cat.x+=cat.vx;
  
  if(cat.x<0)cat.x=0;
  if(cat.x+cat.w>480)cat.x=480-cat.w;
  
  cat.onGround=false;
  for(let p of platforms){
    if(cat.x+cat.w>p.x&&cat.x<p.x+p.w&&cat.y+cat.h>=p.y&&cat.y+cat.h<=p.y+20&&cat.vy>=0){
      cat.y=p.y-cat.h;
      cat.vy=0;
      cat.onGround=true;
    }
  }
  
  if(cat.y>720){
    cat.y=580;
    cat.vy=0;
    score=Math.max(0,score-1);
  }

  for(let f of fishes){
    f.x+=f.vx;
    f.y+=f.vy;
    f.life--;
    if(f.x<20||f.x>460)f.vx*=-1;
    if(f.y<80||f.y>550)f.vy*=-1;
  }
  
  fishes=fishes.filter(f=>f.life>0);
  if(Math.random()<0.02)spawnFish();

  for(let f of fishes){
    if(Math.abs(cat.x+cat.w/2-f.x)<35&&Math.abs(cat.y+cat.h/2-f.y)<35){
      score++;
      playEatSound();
      addEffect(f.x,f.y);
      cat.glow=40;
      f.life=0;
    }
  }
  
  for(let e of effects)e.alpha-=0.03;
  effects=effects.filter(e=>e.alpha>0);
  if(cat.glow>0)cat.glow--;
}

// üêæ Áπ™Ë£ΩÈ†êË®≠Ë≤ìÂí™
function drawDefaultCat(x, y, w, h) {
  ctx.fillStyle = '#1a1a1a';
  ctx.fillRect(x, y, w, h);
  
  ctx.fillStyle = '#0ff';
  ctx.beginPath();
  ctx.arc(x + w * 0.35, y + h * 0.3, 4, 0, Math.PI * 2);
  ctx.arc(x + w * 0.65, y + h * 0.3, 4, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.fillStyle = '#1a1a1a';
  ctx.beginPath();
  ctx.moveTo(x + 10, y);
  ctx.lineTo(x, y - 10);
  ctx.lineTo(x + 15, y + 5);
  ctx.fill();
  
  ctx.beginPath();
  ctx.moveTo(x + w - 10, y);
  ctx.lineTo(x + w, y - 10);
  ctx.lineTo(x + w - 15, y + 5);
  ctx.fill();
}

function draw(){
  ctx.clearRect(0,0,480,720);
  
  ctx.fillStyle="#0ff3";
  for(let i=0;i<25;i++){
    let x=Math.sin(i*13+Date.now()/600)*200+240;
    let y=(i*37+Date.now()/15)%720;
    ctx.fillRect(x,y,2,2);
  }
  
  ctx.fillStyle="#222";
  ctx.strokeStyle="#0ff";
  ctx.lineWidth=2;
  for(let p of platforms){
    ctx.fillRect(p.x,p.y,p.w,p.h);
    ctx.strokeRect(p.x,p.y,p.w,p.h);
  }
  
  for(let f of fishes){
    ctx.drawImage(fishImg,f.x-15,f.y-10,30,20);
  }
  
  for(let e of effects){
    ctx.globalAlpha=e.alpha;
    ctx.fillStyle="#ffb6e9";
    ctx.font="bold 20px Arial, sans-serif";
    ctx.fillText("+1",e.x,e.y);
    ctx.globalAlpha=1;
  }
  
  if(catImgLoaded && catImg.complete) {
    ctx.drawImage(catImg,cat.x,cat.y,cat.w,cat.h);
  } else {
    drawDefaultCat(cat.x, cat.y, cat.w, cat.h);
  }
  
  if(cat.glow>0){
    ctx.globalAlpha=cat.glow/40;
    ctx.drawImage(sparkle,cat.x-10,cat.y-10,cat.w+20,cat.h+20);
    ctx.globalAlpha=1;
  }
  
  ctx.fillStyle="#0ff";
  ctx.font="bold 20px Arial, sans-serif";
  ctx.fillText("üêü Score: "+score,20,30);
  ctx.font="16px Arial, sans-serif";
  ctx.fillText("‚Üê ‚Üí ÁßªÂãïÔºåÁ©∫ÁôΩÈçµË∑≥",20,55);
}

function loop(){
  if(gameOver)return;
  update();
  draw();
  requestAnimationFrame(loop);
}

setTimeout(() => {
  document.getElementById("loading").style.display="none";
  mobileControls.classList.add("active");
  loop();
}, 2000);
</script>
</body>
</html>
