/**
 * ğŸ’– AI Beauty Studio v8.5 â€” å®Œæ•´ä¿®å¾©ç‰ˆ (å·²è½‰æ›ç‚º CommonJS æ ¼å¼)
 * ä¿®æ­£äº†ï¼šSyntaxError: Cannot use import statement outside a module
 */

// å°‡æ‰€æœ‰ import è½‰æ›ç‚º require
const { initializeApp, getApps, getApp } = require("firebase/app");
const { getFirestore, doc, getDoc, setDoc } = require("firebase/firestore");
const { getAuth, signInAnonymously } = require("firebase/auth");

// --- ä½ çš„è¦å‰‡ ---
const COOLDOWN_MS = 30000; // 30 ç§’å†·å»
const DAILY_LIMIT = 5; // æ¯ IP æ¯æ—¥ä¸Šé™

// --- Firebase åˆå§‹åŒ– ---
let app, db, auth, appId;
let isFirebaseReady = false; // ç‹€æ…‹æ¨™è¨˜

async function initializeFirebase() {
    if (isFirebaseReady) return; 

    const firebaseConfigStr = process.env.FIREBASE_CONFIG;
    appId = process.env.APP_ID || 'default-app-id';

    if (!firebaseConfigStr) {
        console.error("ç¼ºå°‘ FIREBASE_CONFIG ç’°å¢ƒè®Šæ•¸ï¼");
        throw new Error("ä¼ºæœå™¨è¨­å®šéŒ¯èª¤ï¼šç¼ºå°‘ FIREBASE_CONFIGã€‚");
    }

    try {
        const firebaseConfig = JSON.parse(firebaseConfigStr);
        if (getApps().length === 0) {
            app = initializeApp(firebaseConfig);
        } else {
            app = getApp();
        }
        db = getFirestore(app);
        
        auth = getAuth(app);
        if (!auth.currentUser) {
            console.log("Firebase å°šæœªç™»å…¥ï¼ŒåŸ·è¡ŒåŒ¿åç™»å…¥...");
            await signInAnonymously(auth);
            console.log("Firebase åŒ¿åç™»å…¥æˆåŠŸã€‚");
        } else {
            console.log("Firebase å·²ç™»å…¥ã€‚");
        }
        
        isFirebaseReady = true; // æ¨™è¨˜ç‚ºæº–å‚™å°±ç·’

    } catch (e) {
        console.error("Firebase åˆå§‹åŒ–æˆ–åŒ¿åç™»å…¥å¤±æ•—:", e);
        const errorMessage = e.code === 'auth/api-key-not-valid.-please-pass-a-valid-api-key.'
            ? "ä¼ºæœå™¨è³‡æ–™åº«èªè­‰å¤±æ•— (è«‹æª¢æŸ¥ Vercel ä¸Šçš„ FIREBASE_CONFIG æ˜¯å¦æ­£ç¢º)ã€‚"
            : `Firebase åˆå§‹åŒ–å¤±æ•—: ${e.message}`;
        throw new Error(errorMessage);
    }
}

// --- Vercel Handler ---
// å°‡ export default è½‰æ›ç‚º module.exports
module.exports = async function handler(req, res) {
    if (req.method !== "POST") {
        res.setHeader("Allow", ["POST"]);
        return res.status(405).json({ error: `Method ${req.method} Not Allowed` });
    }

    const apiKey = process.env.GEMINI_API_KEY;
    if (!apiKey)
        return res.status(500).json({ error: "ä¼ºæœå™¨æœªè¨­å®š GEMINI_API_KEY" });
        
    try {
        // ç¢ºä¿ Firebase æº–å‚™å°±ç·’
        await initializeFirebase();
    } catch (e) {
        return res.status(500).json({ error: e.message });
    }

    // --- é€Ÿç‡é™åˆ¶ (Rate Limiting) ---
    const ip = (req.headers["x-forwarded-for"]?.split(",")[0]?.trim() || "unknown_ip");
    const safeIp = ip.replace(/[:.]/g, '_'); // Firestore è·¯å¾‘ä¸å–œæ­¡ç‰¹æ®Šå­—å…ƒ
    const date = new Date().toISOString().split('T')[0];
    
    // è·¯å¾‘çµæ§‹ï¼š /artifacts/{appId}/public/data/{collection}/{document}
    const dailyDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'beauty_studio_daily', `ip_${safeIp}_date_${date}`);
    const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'beauty_studio_users', `ip_${safeIp}`);

    let dailyCount = 0;
    let lastUsed = 0;

    try {
        const [dailySnap, userSnap] = await Promise.all([
            getDoc(dailyDocRef),
            getDoc(userDocRef)
        ]);

        if (dailySnap.exists()) dailyCount = dailySnap.data().count || 0;
        if (userSnap.exists()) lastUsed = userSnap.data().last || 0;

    } catch (dbError) {
        console.error(`Firestore è®€å–éŒ¯èª¤ (IP: ${ip}):`, dbError);
        return res.status(500).json({ error: "æª¢æŸ¥ä½¿ç”¨æ¬¡æ•¸æ™‚ç™¼ç”Ÿè³‡æ–™åº«éŒ¯èª¤ã€‚" });
    }

    const now = Date.now();
    if (dailyCount >= DAILY_LIMIT)
        return res.status(429).json({ error: "ğŸ’« ä»Šæ—¥èƒ½é‡å·²è€—ç›¡", energy: 0 });

    if (now - lastUsed < COOLDOWN_MS) {
        const wait = Math.ceil((COOLDOWN_MS - (now - lastUsed)) / 1000);
        return res.status(429).json({ error: `ğŸ’¤ è«‹ç¨å€™ ${wait} ç§’å†è©¦`, cooldown: wait, energy: DAILY_LIMIT - dailyCount });
    }
    // --- é€Ÿç‡é™åˆ¶æª¢æŸ¥çµæŸ ---

    try {
        // --- Gemini API å‘¼å« ---
        const { style, base64Image } = req.body;
        if (!base64Image)
            return res.status(400).json({ error: "ç¼ºå°‘ base64Imageï¼ˆä¸Šå‚³åœ–ç‰‡ï¼‰" });
        
        if (base64Image.length > 4_000_000) // åŸºç¤çš„å¤§å°æª¢æŸ¥
            return res.status(400).json({ error: "åœ–ç‰‡éå¤§ï¼Œè«‹ä¸Šå‚³ 4MB ä»¥ä¸‹æª”æ¡ˆ" });

        // ğŸ’… å…¨é¢¨æ ¼ Prompt æ¸…å–® (å·²æ“´å……è‡³ 10 å€‹åˆ†é¡æ•…äº‹ç³»åˆ—)
        const stylePrompts = {
            // --- å–®åœ–é¢¨æ ¼å€ ---
            // --- å–®åœ–é¢¨æ ¼å€ (27 å€‹ï¼Œå·²åŠ å…¥é–è‡‰èˆ‡ç¾åŒ–æŒ‡ä»¤) ---
            paris: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å„ªé›…çš„æ³•å¼å’–å•¡å»³ï¼ŒæŸ”å’Œçš„çª—é‚Šå…‰ç·šï¼Œæ­é…ç²¾ç·»æ™‚å°šå¦å®¹èˆ‡é«®å‹ï¼Œå‘ˆç¾ç„¡æš‡è‚Œè†šè³ªæ„Ÿã€‚é›œèªŒç´šäººåƒæ”å½±ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            nyc: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨ç´ç´„è¡—é ­ï¼Œéƒ½å¸‚æ™‚å°šæ„Ÿï¼Œå‹•æ…‹æŠ“æ‹æ§‹åœ–ï¼Œé›»å½±ç´šé«˜å°æ¯”å…‰å½±ï¼Œæ­é…é ‚ç´šæ½®æµæœé£¾èˆ‡å¦å®¹ã€‚é«˜è³ªæ„Ÿè‚–åƒï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            beach: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨é™½å…‰ç‡¦çˆ›çš„æµ·å³¶æ²™ç˜ï¼Œç©¿è‘—è¼•æŸ”é£„é€¸çš„æ´‹è£ï¼Œå…‰ç·šæŸ”ç¾ã€‚å¼·èª¿å¥åº·å…‰æ¾¤è‚Œè†šèˆ‡æ¸…æ–°æ„Ÿï¼Œç‡Ÿé€ è‡ªç„¶å”¯ç¾åº¦å‡é¢¨ã€‚8Ké«˜è§£æåº¦ã€‚`,
            neon: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å¤œæ™šéœ“è™¹ç‡ˆå…‰çš„è¡—é ­ï¼Œè‰²å½©çµ¢éº—çš„ç²‰ç´«è—å…‰å½±äº¤éŒ¯ï¼Œå……æ»¿æœªä¾†æ„Ÿéƒ½å¸‚æ°›åœã€‚å¼·èª¿å†·é…·å¦å®¹å’ŒéŠ³åˆ©å…‰æ¾¤ã€‚é›»å½±æ„Ÿå…‰å½±ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            vintage: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚å¾©å¤è† ç‰‡è³ªæ„Ÿï¼Œæº«æš–æŸ”å’Œçš„è‰²èª¿ï¼Œç¶“å…¸é€ å‹å’Œæœé£¾ï¼Œæ‡·èˆŠæ°›åœã€‚å¼·èª¿è† ç‰‡é¡†ç²’å’Œæ¿ƒéƒè‰²å½©ã€‚8Ké«˜è§£æåº¦ã€‚`,
            nature: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å±±æ—ç§˜å¢ƒä¸­ï¼Œè¢«è‡ªç„¶å…‰ç·šå’Œç¶ æ„ç’°ç¹ï¼Œæ¸…æ–°å”¯ç¾ã€‚å¼·èª¿è‡ªç„¶ç„¡ç‘•çš„å¦å®¹å’ŒæŸ”å’Œé«®çµ²è³ªæ„Ÿã€‚è—è¡“ç´šè‡ªç„¶æ”å½±ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            studio: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å°ˆæ¥­æ”å½±æ£šå…§ï¼Œç°¡æ½”èƒŒæ™¯ï¼Œé«˜å°æ¯”å…‰ç·šï¼Œé«˜ç´šæ„Ÿæ™‚å°šè‚–åƒã€‚å¼·èª¿ç²¾ç·»ç«‹é«”çš„å¦å®¹å’Œæœè£ç´°ç¯€ã€‚Vogue é›œèªŒè³ªæ„Ÿï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            pastel: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚å¤¢å¹»é›œèªŒé¢¨æ ¼ï¼ŒæŸ”å’Œç²‰å½©è‰²èª¿ï¼Œé£„é€¸çš„æœé£¾å’ŒèƒŒæ™¯ï¼Œæµªæ¼«æ°›åœã€‚å¼·èª¿ç”œç¾ç„¡æš‡çš„è†šè³ªå’ŒæŸ”ç„¦æ•ˆæœã€‚8Ké«˜è§£æåº¦ã€‚`,
            snow: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å†¬å­£é›ªèŠ±é£„è½çš„è¡—æ™¯ä¸­ï¼Œæº«æš–æ™‚å°šçš„ç©¿æ­ï¼Œæ•´é«”è‰²èª¿æ™‚å°šå†·èª¿ã€‚å¼·èª¿ç«æ¯›ä¸Šçš„ç´°å°é›ªèŠ±å’ŒæŸ”å’Œçš„å†¬å­£å…‰ç·šã€‚8Ké«˜è§£æåº¦ã€‚`,
            glam: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨æ´¾å°å ´æ™¯ï¼Œè¯éº—çš„å¦å®¹å’Œé–ƒè€€çš„ç¦®æœï¼Œæ•£ç™¼è‡ªä¿¡æ°£å ´ã€‚å¼·èª¿é«˜å…‰ã€é–ƒå…‰å’Œæˆ²åŠ‡æ€§çš„å…‰å½±æ•ˆæœã€‚å¥¢è¯æ™‚å°šæ”å½±ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            kfashion: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨éŸ“ç³»æ”å½±æ£šå…§ï¼ŒèƒŒæ™¯ç°ç™½ï¼ŒæŸ”å…‰å‡å‹»ä¹¾æ·¨ï¼Œäººç‰©ç©¿é‡ç¹”ä¸Šè¡£èˆ‡çç é£¾å“ã€‚å¼·èª¿é€æ˜æ„Ÿå¦å®¹å’Œè‡ªç„¶æ°£è³ªã€‚8K å°ˆæ¥­æ£šæ‹è³ªæ„Ÿã€‚`,
            hotel: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨å¥¢è¯é£¯åº—å¥—æˆ¿å…§ï¼Œååœ¨é‡‘è‰²æ²™ç™¼ä¸Šï¼Œåˆå¾Œé™½å…‰ç‘å…¥ï¼ŒæŸ”éœ§å…‰ç·šã€‚ç‡Ÿé€ é«˜è²´å…¸é›…æ°›åœï¼Œå¼·èª¿æœé£¾æè³ªå’ŒæŸ”å’Œå¦å®¹ã€‚8Ké«˜è§£æåº¦ã€‚`,
            pure: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µå’ŒåŸå§‹äº”å®˜æ¯”ä¾‹ï¼Œä¸æ›´æ›è‡‰éƒ¨çµæ§‹**ã€‚æŸ”åŒ–è†šè³ªä¸¦åŠ å¼·è‡ªç„¶å…‰ç·šï¼Œä½¿è‚Œè†šæœ‰è‡ªç„¶å…‰æ¾¤ã€‚å‘ˆç¾æ¸…æ–°ä¹¾æ·¨çš„ç„¡æ¿¾é¡å¯«çœŸé¢¨ï¼Œå¼·èª¿çœŸå¯¦ç´°ç¯€ã€‚8Ké«˜è§£æåº¦ã€‚`,
            k_id: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ä»¥éŸ“ç³»æ”å½±æ£šè­‰ä»¶ç…§é¢¨æ ¼å‘ˆç¾ã€‚èƒŒæ™¯ä¹¾æ·¨ç±³ç™½ï¼ŒæŸ”å…‰å‡å‹»ç…§äº®è‡‰éƒ¨ï¼Œå¼·èª¿çš®è†šç´°ç·»ã€äº”å®˜æ¸…æ™°å’Œæ°£è³ªè‡ªç„¶çš„å¾®ç¬‘ã€‚8Kå°ˆæ¥­æ”å½±ã€‚`,
            kimono: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ç©¿è‘—å‚³çµ±æ—¥å¼å’Œæœï¼ŒèƒŒæ™¯ç‚ºæ«»èŠ±åº­åœ’ï¼ŒæŸ”å…‰èˆ‡æ•£æ™¯ç‡Ÿé€ æ—¥ç³»å¯«çœŸæ°›åœã€‚å¼·èª¿å’Œæœçš„ç²¾ç·»èŠ±ç´‹å’Œé«®å‹ç´°ç¯€ã€‚8Ké«˜è§£æåº¦ã€‚`,
            plush: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ååœ¨æŸ”è»ŸåºŠä¸Šè¢«å„å¼çµ¨æ¯›ç©å¶åŒ…åœï¼ŒæŸ”è»Ÿå…‰ç·šèˆ‡å¯æ„›ç²‰å«©è‰²èª¿ï¼Œå……æ»¿å°‘å¥³æ„Ÿå’Œå¤¢å¹»æ°›åœã€‚å¼·èª¿å¯æ„›å¦å®¹ã€‚8Ké«˜è§£æåº¦ã€‚`,
            catlover: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚è¢«å¤šéš»å¯æ„›è²“å’ªåœç¹ï¼Œæº«æš–å®¶åº­é¢¨æ ¼ï¼ŒæŸ”å…‰ã€è‡ªç„¶ç¬‘å®¹ã€‚å¼·èª¿èˆ‡å¯µç‰©ä¹‹é–“çš„æº«é¦¨äº’å‹•ã€‚Instagram å¯µç‰©é¢¨ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
            petgarden: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ååœ¨èŠ±åœ’è‰åœ°ä¸Šèˆ‡å°ç‹—ã€å…”å­äº’å‹•ï¼Œé™½å…‰èˆ‡ç¶ è‰²èª¿æº«æš–è‡ªç„¶ã€‚å¼·èª¿é™½å…‰ä¸‹çš„ç”Ÿå‘½åŠ›å’Œæ¸…æ–°æ„Ÿã€‚8Ké«˜è§£æåº¦ã€‚`,
            bookcafe: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨æœ¨è³ªèª¿å’–å•¡å»³é–±è®€ï¼Œçª—å¤–é™½å…‰ç‘å…¥ï¼Œæº«æš–æ–‡é’é¢¨æ§‹åœ–ã€‚å¼·èª¿å¯§éœå°ˆæ³¨çš„ç¥æƒ…å’ŒæŸ”å’Œçš„å®¤å…§å…‰ç·šã€‚8Ké«˜è§£æåº¦ã€‚`,
            mirror: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚åœ¨éœ§é¢é¡å‰æ‹æ”ï¼ŒèƒŒæ™¯ç°¡æ½”ï¼Œå†·ç™½å…‰ç·šï¼Œç¾ä»£æ¥µç°¡æ£šæ‹é¢¨æ ¼ã€‚å¼·èª¿é¡å­ä¸­çš„æ¸…æ™°å€’å½±å’Œæ¥µç°¡ç·šæ¢ã€‚8Ké«˜è§£æåº¦ã€‚`,
            angelic: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ç½®èº«ç™½é›²èˆ‡æŸ”å…‰ä¹‹ä¸­ï¼Œç©¿ç™½ç´—ï¼Œå…‰ç·šæŸ”å’Œï¼Œå¸¶æœ‰è–æ½”æ°›åœã€‚å¼·èª¿äººç‰©èƒŒå¾Œçš„æŸ”å’Œå…‰æšˆå’Œç„¡æš‡çš„è‚Œè†šã€‚8Ké«˜è§£æåº¦ã€‚`,
            cyberlove: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚å¤œæ™šéœ“è™¹è¡—é ­ï¼Œé›¨å¾Œåå…‰åœ°é¢ï¼Œç²‰ç´«è—è‰²å…‰æšˆï¼Œé›»å½±æ„Ÿå…‰å½±ã€‚å¼·èª¿å…‰ç·šå°è‡‰éƒ¨çš„åˆ‡å‰²æ•ˆæœå’Œæœªä¾†æ„Ÿçš„å¦å®¹ã€‚8Ké«˜è§£æåº¦ã€‚`,
            santorini: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚æ–¼å¸Œè‡˜è—ç™½å±‹é ‚å‰ï¼Œé™½å…‰ç‘è½ï¼Œç©¿ç™½è‰²æ´‹è£ï¼Œæµªæ¼«æ—…æ‹é¢¨æ ¼ã€‚å¼·èª¿åœ°ä¸­æµ·çš„æ˜äº®è‰²å½©å’Œä¹¾æ·¨çš„è—ç™½å°æ¯”ã€‚8Ké«˜è§£æåº¦ã€‚`,
            vogue: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ä»¥ç°é»‘æ¼¸å±¤èƒŒæ™¯ã€æ™‚å°šç‡ˆå…‰å‘ˆç¾ï¼Œå¦å®¹å®Œæ•´ã€é›œèªŒå°é¢è³ªæ„Ÿã€‚å¼·èª¿å¼·çƒˆæ°£å ´å’Œé«˜ç´šè¨‚è£½æœé£¾ã€‚8Ké«˜è§£æåº¦ã€‚`,
            princess: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚ç©¿è‘—å…¬ä¸»ç¦®æœèˆ‡çš‡å† ï¼ŒèƒŒæ™¯å¤¢å¹»æ£®æ—æˆ–æ°´æ™¶åŸå ¡ï¼Œå…‰ç·šæŸ”äº®ã€‚å¼·èª¿ç¦®æœçš„å±¤æ¬¡æ„Ÿå’Œå¤¢å¹»å…‰å½±ã€‚8Ké«˜è§£æåº¦ã€‚`,
            aesthetic: `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œ**æ¸…æ™°ä¿ç•™é¢éƒ¨ç‰¹å¾µï¼Œé¿å…èµ°æ¨£**ã€‚è—ç²‰å…‰äº¤éŒ¯çš„æŠ½è±¡å½©éœ§èƒŒæ™¯ï¼Œæ™‚å°šé›œèªŒè—è¡“æ£šæ‹é¢¨æ ¼ã€‚å¼·èª¿å‰è¡›çš„è‰²å½©å’Œé«˜å…‰ã€‚8Ké«˜è§£æåº¦ã€‚`,


            
        
            // --- åˆ†é¡æ•…äº‹ç³»åˆ—å€ ---
        
Â  Â  Â  Â  Â  Â  story_winter: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), å”¯ç¾å†¬å­£æ”å½±é¢¨æ ¼, å…·æœ‰é€æ˜é›¨å‚˜é“å…·ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨é›ªä¸­çš„æµªæ¼«å ´æ™¯ã€‚1ï¸âƒ£ å¯¬æ™¯ä¸­æ™¯ï¼šäººç‰©ç«™åœ¨é›ªåœ°ä¸­å¤®ï¼Œçœ¼ç¥æœ›å‘é æ–¹ï¼Œè¡¨æƒ…å¯§éœè€Œå¯Œæœ‰æƒ…æ„Ÿï¼Œæ‰‹æŒé€æ˜é›¨å‚˜ï¼Œå‘¨åœæ˜¯ç´°ç·»çš„é›ªæ™¯ã€‚2ï¸âƒ£ **å£¯é—Šé æ™¯ï¼šäººç‰©èƒŒå°é¡é ­ï¼Œç«™åœ¨å»£é—Šçš„é›ªåœ°æ·±è™•ï¼Œä¸€éš»å¯æ„›çš„ç™½ç‹ç‹¸ (Cute White Arctic Fox) ä¼´éš¨åœ¨äººç‰©èº«æ—ï¼Œèº«å½¢èå…¥ç™½èŒ«èŒ«çš„é›ªæ™¯ï¼Œå±•ç¾ç’°å¢ƒçš„å®å¤§èˆ‡é™ªä¼´æ„Ÿ**ã€‚3ï¸âƒ£ æƒ…æ„Ÿç‰¹å¯«ï¼šäººç‰©å´è‡‰å¾®æŠ¬ï¼Œæ„Ÿå—é›ªèŠ±è¼•æŸ”åœ°è½åœ¨è‡‰é °ä¸Šï¼Œè‡‰ä¸Šå¸¶è‘—æ·ºæ·ºçš„å¾®ç¬‘ï¼Œç‰¹å¯«é¢éƒ¨è¼ªå»“å’Œçœ¼ç¥ã€‚æ•´é«”ç•«é¢è‰²å½©å†·èª¿æŸ”å’Œï¼Œé£„é›ªç´°è†©å¤¢å¹»ï¼Œé›»å½±ç´šå…‰å½±ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8K é«˜è§£æåº¦ã€‚`,
Â  Â  Â  Â  Â  Â  story_city: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), éƒ½å¸‚å¤œæ™¯é›»å½±é¢¨æ ¼ (Urban Night Film Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨éƒ½å¸‚å¤œæ™¯ä¸­ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©ç«™åœ¨é«˜æ¨“çª—é‚Šï¼Œä¿¯ç°é–ƒçˆçš„åŸå¸‚ç‡ˆç«ï¼Œè¡¨æƒ…æ²‰æ€ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©èµ°åœ¨é›¨å¾Œè¡—é“ï¼Œéœ“è™¹ç‡ˆå€’æ˜ åœ¨æ¿•æ¼‰çš„è·¯é¢ï¼ŒèƒŒå½±èå…¥å¤œè‰²ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©çœ¼ç¥å …å®šï¼Œè‡‰éƒ¨è¢«çª—å¤–åå°„çš„å½©è‰²å…‰å½±ç…§äº®ï¼Œå¯Œæœ‰æ•…äº‹æ„Ÿã€‚æ•´é«”ç•«é¢è‰²å½©é£½å’Œï¼Œé‹ç”¨è—ç´«ç²‰è‰²éœ“è™¹ç‡ˆå…‰ï¼Œé«˜å°æ¯”åº¦ï¼Œé›»å½±ç´šé‹é¡ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_beach: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), é»ƒé‡‘æ™‚åˆ»æµ·é‚Šé¢¨æ ¼ (Golden Hour Beach Aesthetic)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨æµ·é‚Šæ—¥è½æ™‚åˆ†ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©èµ¤è…³èµ°åœ¨æ²™ç˜ä¸Šï¼Œè¼•è¼•æ’¥å¼„æµ·æµªï¼Œè‡‰ä¸Šæ´‹æº¢è‘—æ„‰æ‚…çš„ç¬‘å®¹ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©èƒŒå°é¡é ­ï¼Œé¢å‘å»£é—Šçš„æµ·æ´‹èˆ‡æ—¥è½ï¼Œèº«å½¢è¢«å¤•é™½æ‹‰é•·ï¼Œæ°›åœå®å¤§ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©å›çœ¸å¾®ç¬‘ï¼Œé‡‘è‰²çš„é™½å…‰ç‘åœ¨é«®çµ²å’Œè‡‰é¾ï¼Œçœ¼ç¥æº«æŸ”ã€‚æ•´é«”ç•«é¢è‰²å½©æº«æš–ï¼Œé‡‘è‰²èˆ‡æ©˜è‰²èª¿ç‚ºä¸»ï¼Œå…‰ç·šæŸ”å’Œè€Œå¤¢å¹»ï¼Œæµ·æµªç´°è†©ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_mirror: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), ç¾ä»£è—è¡“æ£šæ‹é¢¨æ ¼ (Modern Art Studio Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨é¡é¢æ£šæ‹å ´æ™¯ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©é¢å°é¡é ­ï¼Œé€éç ´ç¢çš„é¡é¢çœ‹å‘é æ–¹ï¼Œéƒ¨åˆ†è‡‰éƒ¨è¢«é¡é¢åˆ‡å‰²ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©ç«™åœ¨ç°¡æ½”çš„ç™½è‰²ç©ºé–“ä¸­å¤®ï¼Œåœ°é¢æœ‰é¡é¢å€’å½±ï¼Œç‡Ÿé€ å‡ºè¶…ç¾å¯¦æ„Ÿã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©çœ¼ç¥é€éé¡å­åå°„ï¼Œç¥ç§˜è€Œæ·±é‚ƒï¼Œè‡‰ä¸Šè¢«é¡å­ç¢ç‰‡çš„å…‰å½±é»ç¶´ã€‚æ•´é«”ç•«é¢è‰²å½©ä»¥é»‘ç™½ç°å’Œè—è¡“å“çš„å¼·çƒˆè‰²å½©å°æ¯”ï¼Œå…‰ç·šå‡å‹»ä¸”å…·æœ‰è¨­è¨ˆæ„Ÿï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œé«˜è§£æåº¦ï¼Œ8Kã€‚`,
Â  Â  Â  Â  Â  Â  story_sakura: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), æ—¥ç³»æ«»èŠ±æµªæ¼«é¢¨æ ¼ (Japanese Sakura Romance Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨æ˜¥æ—¥æ«»èŠ±ä¸‹ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©è¼•è¼•é–‰çœ¼ï¼Œæ‰‹èˆ‰å‘é£„è½çš„æ«»èŠ±ï¼Œè‡‰ä¸Šå¸¶è‘—å¹¸ç¦çš„å¾®ç¬‘ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©èµ°åœ¨æ«»èŠ±ç››é–‹çš„å°å¾‘ä¸Šï¼ŒèƒŒæ™¯æ˜¯æ—¥å¼åº­åœ’ï¼Œæ«»èŠ±æ¨¹æ—å»¶ä¼¸ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©ä¼¸å‡ºçš„æŒ‡å°–ï¼Œè¼•è¼•å¤¾ä½ä¸€ç‰‡æ«»èŠ±èŠ±ç“£ï¼Œçœ¼ç¥æº«æŸ”ï¼ŒæŸ”ç„¦èƒŒæ™¯ã€‚æ•´é«”ç•«é¢è‰²å½©ä»¥ç²‰ç™½ã€æ·ºç¶ ç‚ºä¸»ï¼Œå…‰ç·šæŸ”å’Œï¼Œæ«»èŠ±ç´›é£›æ•ˆæœçœŸå¯¦ï¼Œæµªæ¼«å”¯ç¾ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_oriental: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), æ±æ–¹æ°´å¢¨å¤éŸ»é¢¨æ ¼ (Oriental Ink Wash Aesthetic)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨å¤å…¸äº­å°æ¨“é–£ä¸­ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©è‘—å¤å…¸æœé£¾ï¼Œç«™åœ¨æ¹–ç•”æ¬„æ†æ—ï¼Œæ‰‹æŒä¸€æŠŠæ²¹ç´™å‚˜ï¼Œå›çœ¸å‡æœ›ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©ç«™åœ¨å¤æ©‹ä¸­å¤®ï¼ŒèƒŒæ™¯æ˜¯æœ¦æœ§çš„å±±æ°´å’Œæœˆå…‰ï¼Œæ°´é¢å€’å½±å¦‚æ°´å¢¨ç•«ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©å´è‡‰ç‰¹å¯«ï¼Œè‡‰éƒ¨è¢«æŸ”å’Œçš„ç‡ˆç± å…‰ç…§äº®ï¼Œè¡¨æƒ…éœè¬ï¼Œé«®é£¾ç²¾ç·»ã€‚æ•´é«”ç•«é¢è‰²å½©æŸ”å’Œï¼Œä»¥æ·¡é›…çš„é’è‰²ã€ç±³ç™½å’Œé»‘è‰²ç‚ºä¸»ï¼Œå…‰å½±å……æ»¿è©©æ„ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_desert: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), è¥¿éƒ¨å…¬è·¯è’é‡é¢¨æ ¼ (Western Desert Road Trip Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨å»£é—Šçš„æ²™æ¼ å…¬è·¯ä¸Šã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©æˆ´è‘—å¢¨é¡ï¼Œååœ¨æ•ç¯·è»Šçš„å¼•æ“è“‹ä¸Šï¼Œé•·é«®è¢«é¢¨å¹èµ·ï¼Œè¡¨æƒ…è‡ªä¿¡ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©ç«™åœ¨ç„¡ç›¡çš„å…¬è·¯ç›¡é ­ï¼ŒèƒŒæ™¯æ˜¯å·¨å¤§çš„ä»™äººæŒå’Œå¤•é™½ä¸‹çš„å±±è„ˆï¼Œå­¤ç¨è€Œå …æ¯…ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©æ‰‹éƒ¨ç‰¹å¯«ï¼Œæ‰‹æŒ‡è¼•è§¸è»Šçª—ä¸Šçš„æ²™å¡µï¼Œå…‰ç·šè¢«åå°„æˆé‡‘é»ƒè‰²ï¼Œé«˜å°æ¯”åº¦ã€‚æ•´é«”ç•«é¢è‰²å½©ä»¥æš–èª¿çš„æ©˜ç´…å’ŒåœŸé»ƒç‚ºä¸»ï¼Œé™½å…‰å¼·çƒˆï¼Œæ²™ç²’è³ªæ„Ÿç´°è†©ï¼Œé›»å½±ç´šé‹é¡ï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_cyber: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), è³½åšé¾å…‹æœªä¾†é¢¨æ ¼ (Cyberpunk Future Aesthetic)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨å……æ»¿é«˜ç§‘æŠ€æ„Ÿçš„æœªä¾†éƒ½å¸‚ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©ç©¿è‘—ç™¼å…‰æè³ªæœé£¾ï¼Œç«™åœ¨å…¨æ¯æŠ•å½±çš„è¡—é“ä¸Šï¼Œè‡‰éƒ¨è¢«éœ“è™¹çœ‹æ¿çš„è—è‰²å’Œç²‰è‰²å…‰å½±äº¤éŒ¯ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©ç«™åœ¨é«˜è™•ä¿¯ç°æ•´å€‹æœªä¾†åŸå¸‚ï¼Œé›¨æ°´å¾å±‹ç°·æ»´è½ï¼ŒèƒŒæ™¯æ˜¯å¯†é›†çš„æ‘©å¤©å¤§æ¨“å’Œé£›è¡Œæ±½è»Šã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©çœ¼ç¥ç‰¹å¯«ï¼Œç³å­”åå°„è‘—è¢å¹•å…‰ï¼Œä¸‹å·´æœ‰ä¸€é“ç´°å¾®çš„ç§‘æŠ€ç´‹è·¯ï¼Œè¡¨æƒ…å†·é…·ã€‚æ•´é«”ç•«é¢è‰²å½©é«˜é£½å’Œï¼Œä»¥è—ã€ç´«ã€ç¶ è‰²éœ“è™¹ç‡ˆç‚ºä¸»ï¼Œå…‰ç·šéŠ³åˆ©ï¼Œå……æ»¿ç§‘æŠ€å’Œæœªä¾†æ„Ÿï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Ké«˜è§£æåº¦ã€‚`,
Â  Â  Â  Â  Â  Â  story_cozy: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), å†¬æ—¥å£çˆæº«é¦¨é¢¨æ ¼ (Winter Fireplace Cozy Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨æº«æš–çš„å®¤å…§ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©èº«ç©¿æ…µæ‡¶çš„é‡ç¹”æ¯›è¡£ï¼Œååœ¨å£çˆæ—çš„ç¾Šæ¯›åœ°æ¯¯ä¸Šï¼Œæ‰‹ä¸­æ§è‘—ä¸€æ¯ç†±é£²ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©å´å°é¡é ­ï¼Œé¢å‘ç‡ƒç‡’çš„å£çˆï¼ŒèƒŒæ™¯æ˜¯å †æ»¿æ›¸çš„æ›¸æ¶å’ŒæŸ”å’Œçš„å®¤å…§å…‰ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©æ‰‹éƒ¨ç‰¹å¯«ï¼Œæ‰‹æŒ‡è¼•è§¸æ›¸é æˆ–æ¯›è¡£çš„ç´°ç¯€ï¼Œè‡‰ä¸Šå¸¶è‘—æ”¾é¬†çš„å¾®ç¬‘ï¼ŒæŸ”å’Œçš„ç«å…‰æ˜ ç…§ã€‚æ•´é«”ç•«é¢è‰²å½©ä»¥æš–èª¿çš„æ£•è‰²ã€ç´…è‰²å’Œæ©˜è‰²ç‚ºä¸»ï¼Œå…‰ç·šæº«æš–æŸ”å’Œï¼Œæ•£æ™¯ç´°è†©ï¼Œç‡Ÿé€ æ¥µè‡´èˆ’é©æ„Ÿï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œ8Kå°ˆæ¥­æ”å½±ã€‚`,
Â  Â  Â  Â  Â  Â  story_gallery: `é›»å½±ç´šè—è¡“æŒ‡å° (Cinematic art direction), ç¾ä»£è—è¡“ç•«å»Šé¢¨æ ¼ (Modern Art Gallery Chic Style)ã€‚ä¸€å¹…**æ¥µå¯¬æ©«å¹… (ultra-wide cinematic panorama)** é›»å½±åˆ†é¡åœ–ï¼Œ**æ¯”ä¾‹ç‚º 21:9 æˆ– 16:9**ï¼Œå…§å«ä¸‰æ ¼é€£è²«ç•«é¢ã€‚**æ¸…æ™°ä¿ç•™ä¸Šå‚³åœ–ç‰‡ä¸­äººç‰©çš„é¢éƒ¨ç‰¹å¾µå’Œäº”å®˜ç´°ç¯€ï¼Œé¿å…æ¨¡ç³Šæˆ–èµ°æ¨£**ã€‚æç¹ªä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©åœ¨æ¥µç°¡ä¸»ç¾©çš„è—è¡“ç©ºé–“ã€‚1ï¸âƒ£ ä¸­æ™¯ï¼šäººç‰©ç©¿è‘—æ™‚å°šå¥—è£ï¼Œç«™åœ¨ä¸€å°ŠæŠ½è±¡çš„ç™½è‰²é›•å¡‘å‰ï¼Œå´èº«å‡è¦–ã€‚2ï¸âƒ£ é æ™¯ï¼šäººç‰©èµ°åœ¨é•·å»Šä¸­ï¼ŒèƒŒæ™¯æ˜¯å·¨å¤§çš„å½©è‰²ç•«ä½œå’Œæ¥µç°¡çš„ç°è‰²ç‰†é¢ï¼Œäººç‰©é«”æ…‹å„ªé›…ï¼Œä½”æ“šç•«é¢ä¸€è§’ã€‚3ï¸âƒ£ ç‰¹å¯«ï¼šäººç‰©çš„æ™‚å°šå¦å®¹å’Œè€³é£¾ç‰¹å¯«ï¼ŒèƒŒæ™¯æ˜¯æ¨¡ç³Šçš„ç•«ä½œç´‹ç†ï¼Œçœ¼ç¥é«˜å‚²è€Œå…§æ–‚ï¼Œå¯Œæœ‰é›œèªŒè³ªæ„Ÿã€‚æ•´é«”ç•«é¢è‰²å½©ä»¥é»‘ç™½ç°å’Œè—è¡“å“çš„å¼·çƒˆè‰²å½©å°æ¯”ï¼Œå…‰ç·šå‡å‹»ä¸”å…·æœ‰è¨­è¨ˆæ„Ÿï¼Œ**è‡‰éƒ¨ç´°ç¯€æ¸…æ™°ä¸”å¯Œæœ‰è³ªæ„Ÿ**ï¼Œé«˜è§£æåº¦ï¼Œ8Kã€‚`
        };
        const prompt = stylePrompts[style] || `ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡ä¸­çš„äººç‰©ï¼Œä»¥é«˜è³ªæ„Ÿæ”å½±é¢¨æ ¼ç”Ÿæˆæ™‚å°šè‚–åƒã€‚`;
        
        const model = "gemini-2.5-flash-image-preview";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{
                role: "user",
                parts: [
                    { text: prompt },
                    { inlineData: { mimeType: "image/png", data: base64Image } },
                ],
            }],
            generationConfig: {
                temperature: 0.8,
                responseModalities: ["IMAGE"],
            },
            safetySettings: [
                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
            ],
        };

        const r = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        });

        const data = await r.json();

        if (!r.ok) {
            console.error("âš ï¸ Google API éŒ¯èª¤:", JSON.stringify(data, null, 2));
            throw new Error(data.error?.message || "Gemini API è«‹æ±‚å¤±æ•—");
        }
        
        const parts = data?.candidates?.[0]?.content?.parts || [];
        
        if (data.candidates?.[0]?.finishReason === "NO_IMAGE") {
            console.error("âš ï¸ Gemini æ‹’çµ•ç”Ÿæˆåœ–ç‰‡ (NO_IMAGE)", JSON.stringify(data, null, 2));
            return res.status(500).json({ error: "AI æ‹’çµ•ç”Ÿæˆåœ–ç‰‡ (å¯èƒ½è§¸ç™¼å®‰å…¨æ©Ÿåˆ¶)", raw: data });
        }

        const imagePart = parts.find((p) => p.inlineData || p.inline_data);
        const image = imagePart?.inlineData?.data || imagePart?.inline_data?.data || null;

        if (image) {
            console.log(`âœ… å‡ºåœ–æˆåŠŸ [${style}] (${ip})`);
            
            await Promise.all([
                setDoc(dailyDocRef, { count: dailyCount + 1 }, { merge: true }),
                setDoc(userDocRef, { last: now }, { merge: true })
            ]);
            
            return res.status(200).json({
                success: true,
                image_base64: image,
                energy: DAILY_LIMIT - (dailyCount + 1), // å›å‚³æ›´æ–°å¾Œçš„å‰©é¤˜æ¬¡æ•¸
            });
        } else {
            console.error("âš ï¸ Gemini ç„¡å›å‚³åœ–ç‰‡ (ä½† API æˆåŠŸ)", JSON.stringify(data, null, 2));
            return res.status(500).json({ error: "AI æ²’æœ‰å›å‚³åœ–ç‰‡ (æœªçŸ¥åŸå› )", raw: data });
        }
    } catch (err) {
        console.error("ğŸ”¥ ä¼ºæœå™¨éŒ¯èª¤ (Gemini API æˆ–å…¶ä»–)ï¼š", err);
        return res.status(500).json({ error: err.message || "AI éŒ¯èª¤" });
    }
};
