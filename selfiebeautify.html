<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸ’– AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  margin: 0;
  font-family: 'Poppins','Noto Sans TC',sans-serif;
  background: radial-gradient(circle at 50% 20%, #2a0038 0%, #12001c 60%, #000 100%);
  color: #fff;
  overflow-x: hidden;
  min-height: 100vh;
}
/* âœ¨ èƒŒæ™¯æŸ”å…‰ */
#bg-glow {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle at 60% 40%, rgba(255,100,255,0.2), transparent 60%),
              radial-gradient(circle at 30% 80%, rgba(255,180,255,0.15), transparent 70%);
  filter: blur(120px);
  animation: float 10s ease-in-out infinite alternate;
  z-index: 0;
}
@keyframes float {
  from { transform: translateY(0); opacity: 0.6; }
  to { transform: translateY(-30px); opacity: 0.9; }
}
/* ä¸»å®¹å™¨ */
.container {
  position: relative;
  z-index: 1;
  max-width: 760px;
  margin: 0 auto;
  padding: 60px 20px;
  text-align: center;
}
/* æ¨™é¡Œ */
h1 {
  font-size: 2.8rem;
  font-weight: 800;
  background: linear-gradient(90deg,#ffbdfc,#ff9df9,#ffffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 40px rgba(255,150,255,0.6);
  margin-bottom: 10px;
}
p.subtitle {
  font-size: 1.1rem;
  color: #ffd6ff;
  margin-bottom: 35px;
  letter-spacing: 1px;
  text-shadow: 0 0 20px rgba(255,150,255,0.5);
}
/* å¡ç‰‡ */
.card {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,150,255,0.25);
  border-radius: 20px;
  box-shadow: inset 0 0 30px rgba(255,255,255,0.06),0 0 20px rgba(255,150,255,0.15);
  backdrop-filter: blur(15px);
  padding: 25px 30px;
  margin-bottom: 25px;
}
/* ä¸Šå‚³å€ */
.upload-zone {
  border: 2px dashed rgba(255,200,255,0.4);
  border-radius: 14px;
  padding: 40px;
  text-align: center;
  background: rgba(255,255,255,0.05);
  transition: 0.3s;
}
.upload-zone:hover {
  background: rgba(255,255,255,0.08);
  border-color: #ffbdfc;
  box-shadow: 0 0 20px rgba(255,160,255,0.3);
}
.preview-img {
  max-width: 100%;
  max-height: 360px;
  margin-top: 20px;
  border-radius: 14px;
  box-shadow: 0 0 30px rgba(255,160,255,0.25);
}
/* æŒ‰éˆ•ç¾¤çµ„ */
.style-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  margin-top: 15px;
}
.style-btn {
  padding: 10px 16px;
  min-width: 130px;
  border-radius: 30px;
  border: none;
  font-weight: 700;
  background: linear-gradient(135deg,#ffbdfc,#ff79e3);
  color: #fff;
  box-shadow: 0 0 12px rgba(255,120,255,0.4);
  transition: all 0.3s;
}
.style-btn:hover {transform: translateY(-2px);box-shadow: 0 0 18px rgba(255,160,255,0.6);}
.style-btn.active {
  background: linear-gradient(135deg,#ff9df9,#ffe6ff);
  color: #8000aa;
  box-shadow: 0 0 25px rgba(255,180,255,0.7);
  transform: scale(1.05);
}
/* ç”ŸæˆæŒ‰éˆ• */
.generate-btn {
  background: linear-gradient(90deg,#ff9df9,#ff6ef5);
  color: #fff;
  border: none;
  border-radius: 40px;
  font-size: 1.1rem;
  font-weight: bold;
  padding: 14px 32px;
  margin-top: 25px;
  box-shadow: 0 0 20px rgba(255,120,255,0.4);
  transition: all 0.3s;
}
.generate-btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,160,255,0.7);}
.generate-btn:disabled {opacity: 0.5; cursor: not-allowed;}
/* çµæœ */
.result-img {
  max-width: 100%;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(255,180,255,0.3);
  margin-top: 20px;
}
/* Loading */
.spinner {
  border: 4px solid rgba(255,255,255,0.2);
  border-top: 4px solid #ffbdfc;
  border-radius: 50%;
  width: 50px; height: 50px;
  margin: 0 auto 15px;
  animation: spin 1s linear infinite;
}
@keyframes spin {to{transform:rotate(360deg)}}
/* èƒ½é‡æ¢ */
#energy-bar {
  position: fixed;
  bottom: 18px; right: 18px;
  width: 150px; height: 10px;
  border-radius: 6px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,180,255,0.4);
  overflow: hidden;
  box-shadow: 0 0 10px rgba(255,120,255,0.3);
}
#energy-fill {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg,#ff9df9,#ffbdfc);
  transition: width 0.3s;
}
</style>
</head>
<body>
<div id="bg-glow"></div>
<div class="container">
  <h1>ğŸ’– AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤</h1>
  <p class="subtitle">ä¸Šå‚³è‡ªæ‹ï¼Œä¸€éµè®Šèº«é›œèªŒç´šæ™‚å°šç…§ âœ¨</p>

  <div class="card">
    <label class="block text-pink-200 mb-2 font-bold">ğŸ“¸ ä¸Šå‚³è‡ªæ‹ç…§</label>
    <div id="upload-zone" class="upload-zone">
      é»æ“Šæˆ–æ‹–æ›³åœ–ç‰‡åˆ°é€™è£¡
      <input type="file" id="file-input" accept="image/jpeg,image/png" class="hidden" />
    </div>
    <img id="preview" class="preview-img hidden" />
  </div>

  <div class="card">
    <label class="block text-pink-200 mb-2 font-bold">ğŸ¨ é¸æ“‡é¢¨æ ¼</label>
    <div class="style-grid">
      <button class="style-btn active" data-style="paris">ğŸ¥ æ³•å¼å’–å•¡å»³</button>
      <button class="style-btn" data-style="nyc">ğŸ™ï¸ ç´ç´„è¡—é ­</button>
      <button class="style-btn" data-style="beach">ğŸ–ï¸ æµ·å³¶å‡æœŸ</button>
      <button class="style-btn" data-style="neon">ğŸ’œ éœ“è™¹å¤œæ‹</button>
      <button class="style-btn" data-style="vintage">ğŸ“· å¾©å¤è† ç‰‡</button>
      <button class="style-btn" data-style="nature">ğŸŒ¿ å±±æ—ç§˜å¢ƒ</button>
      <button class="style-btn" data-style="studio">ğŸ’ æ£šæ‹æ™‚å°š</button>
      <button class="style-btn" data-style="pastel">â˜ï¸ å¤¢å¹»é›œèªŒ</button>
      <button class="style-btn" data-style="snow">â„ï¸ å†¬å­£è¡—æ‹</button>
      <button class="style-btn" data-style="glam">ğŸ‰ æ´¾å°å¥³ç‹</button>
    </div>
    <button id="generate-btn" class="generate-btn" disabled>âœ¨ é–‹å§‹ç”Ÿæˆ</button>
  </div>

  <div id="loading" class="hidden">
    <div class="spinner"></div>
    <p class="text-pink-200 font-bold">AI é­”æ³•è®Šèº«ä¸­...</p>
  </div>

  <div id="result" class="hidden">
    <h2 class="text-pink-200 text-xl font-bold mb-3">âœ¨ å®Œæˆï¼</h2>
    <img id="result-img" class="result-img" />
    <button id="download-btn" class="generate-btn mt-3">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
  </div>
</div>

<!-- èƒ½é‡æ¢ -->
<div id="energy-bar"><div id="energy-fill"></div></div>

<script>
const uploadZone=document.getElementById('upload-zone');
const fileInput=document.getElementById('file-input');
const preview=document.getElementById('preview');
const generateBtn=document.getElementById('generate-btn');
let base64Image=null;

uploadZone.onclick=()=>fileInput.click();
uploadZone.ondragover=e=>{e.preventDefault();uploadZone.style.borderColor='#ffbdfc';};
uploadZone.ondrop=e=>{e.preventDefault();handleFile(e.dataTransfer.files[0]);};
fileInput.onchange=e=>handleFile(e.target.files[0]);

function handleFile(file){
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    base64Image=e.target.result.split(',')[1];
    preview.src=e.target.result;
    preview.classList.remove('hidden');
    generateBtn.disabled=false;
  };
  reader.readAsDataURL(file);
}

// === é¢¨æ ¼é¸æ“‡ ===
let style='paris';
document.querySelectorAll('.style-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.style-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    style=btn.dataset.style;
  };
});

// === ç”Ÿæˆ ===
document.getElementById('generate-btn').onclick=async()=>{
  if(!base64Image)return alert("è«‹å…ˆä¸Šå‚³åœ–ç‰‡ï¼");
  document.getElementById('loading').classList.remove('hidden');
  document.getElementById('result').classList.add('hidden');

  try{
    const res=await fetch('/api/gemini_beauty',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({style:style,base64Image})
    });
    const data=await res.json();
    document.getElementById('loading').classList.add('hidden');

    if(res.status===429){
      if(data.cooldown)alert(`ğŸ’« è«‹ç¨å€™ ${data.cooldown} ç§’å†è©¦`);
      else if(data.energy===0)alert("âš ï¸ ä»Šæ—¥èƒ½é‡å·²è€—ç›¡ï¼Œæ˜å¤©å†è©¦ï½");
      updateEnergyBar(data.energy||0);
      return;
    }

    if(data.image_base64){
      document.getElementById('result-img').src='data:image/png;base64,'+data.image_base64;
      document.getElementById('result').classList.remove('hidden');
      updateEnergyBar(data.energy);
    }else alert("âŒ æ²’æœ‰ç”Ÿæˆåœ–ç‰‡ï¼š" + (data.error||"è«‹ç¨å¾Œå†è©¦"));
  }catch(err){
    document.getElementById('loading').classList.add('hidden');
    alert("âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message);
  }
};

// === èƒ½é‡æ¢ ===
function updateEnergyBar(energy){
  const fill=document.getElementById('energy-fill');
  const percent=Math.max(0,Math.min(100,(energy/5)*100));
  fill.style.width=percent+'%';
  fill.style.background=percent>40?'linear-gradient(90deg,#ff9df9,#ffbdfc)':'linear-gradient(90deg,#ff6b9d,#ffc0c0)';
}

// === ä¸‹è¼‰ ===
document.getElementById('download-btn').onclick=()=>{
  const link=document.createElement('a');
  link.href=document.getElementById('result-img').src;
  link.download='beauty_'+Date.now()+'.png';
  link.click();
};
</script>
</body>
</html>
