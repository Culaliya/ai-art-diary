<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ’œ AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤ v2</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  margin: 0;
  font-family: 'Orbitron', 'Noto Sans TC', sans-serif;
  background: radial-gradient(circle at 50% 20%, #1a0033 0%, #2a0055 60%, #000 100%);
  background-attachment: fixed;
  color: #fff;
  overflow-x: hidden;
  min-height: 100vh;
}

/* èƒŒæ™¯éœ“è™¹å…‰æšˆ */
#glow-bg {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: radial-gradient(circle at 50% 50%, rgba(255,0,255,0.2), transparent 70%);
  filter: blur(100px);
  z-index: 0;
  animation: pulse 8s ease-in-out infinite alternate;
}
@keyframes pulse {
  0% {opacity:0.3; transform:scale(1);}
  100% {opacity:0.6; transform:scale(1.2);}
}

/* ä¸»å®¹å™¨ */
.container {
  position: relative;
  z-index: 1;
  max-width: 900px;
  margin: 0 auto;
  padding: 60px 20px;
  text-align: center;
}

/* æ¨™é¡Œ */
h1 {
  font-size: 3.5rem;
  font-weight: 900;
  color: #ffbdfc;
  text-shadow: 0 0 40px #ff3eff, 0 0 80px #b000ff;
  margin-bottom: 10px;
}
p.subtitle {
  font-size: 1.3rem;
  color: #ffccff;
  margin-bottom: 40px;
  text-shadow: 0 0 25px #b065ff;
}

/* å¡ç‰‡ */
.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,150,255,0.4);
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(255,100,255,0.2);
  backdrop-filter: blur(10px);
  padding: 30px;
  margin-bottom: 30px;
}

/* ä¸Šå‚³å€ */
.upload-zone {
  border: 2px dashed #d28fff;
  border-radius: 16px;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  transition: 0.3s;
}
.upload-zone:hover {
  border-color: #ff9df5;
  background: rgba(255,255,255,0.05);
  box-shadow: 0 0 20px rgba(255,150,255,0.4);
}
.preview-img {
  max-width: 100%;
  max-height: 400px;
  margin-top: 20px;
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(255,120,255,0.3);
}

/* é¢¨æ ¼é¸æ“‡ */
.style-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
  gap: 12px;
  margin-top: 20px;
}
.style-btn {
  padding: 12px;
  border-radius: 12px;
  background: linear-gradient(135deg, #7b2ff7, #f107a3);
  border: none;
  color: white;
  font-weight: bold;
  transition: 0.3s;
}
.style-btn.active {
  transform: scale(1.05);
  box-shadow: 0 0 20px #ff6fff;
}

/* ç”ŸæˆæŒ‰éˆ• */
.generate-btn {
  background: linear-gradient(135deg, #d76dff, #ff2a6d);
  color: #fff;
  border: none;
  border-radius: 25px;
  font-size: 1.2rem;
  font-weight: bold;
  padding: 15px 40px;
  margin-top: 25px;
  transition: all 0.3s;
  box-shadow: 0 0 25px rgba(255,100,255,0.4);
}
.generate-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 40px rgba(255,120,255,0.6);
}
.generate-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* çµæœåœ– */
.result-img {
  max-width: 100%;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(255,150,255,0.3);
  margin-top: 20px;
}

/* Loading */
#loading {
  display: none;
  text-align: center;
  margin: 40px auto;
}
.spinner {
  width: 60px;
  height: 60px;
  border: 6px solid rgba(255,255,255,0.2);
  border-top: 6px solid #ff4df5;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}
@keyframes spin {to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div id="glow-bg"></div>
<div class="container">
  <h1>ğŸ’œ AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤</h1>
  <p class="subtitle">ä¸Šå‚³è‡ªæ‹ï¼Œä¸€éµè®Šèº«ç¶²ç¾ âœ¨</p>

  <div class="card">
    <label class="block text-pink-200 text-lg mb-2">ğŸ“¸ ä¸Šå‚³è‡ªæ‹ç…§</label>
    <div id="upload-zone" class="upload-zone">
      <p>é»æ“Šæˆ–æ‹–æ›³åœ–ç‰‡åˆ°é€™è£¡</p>
      <input type="file" id="file-input" accept="image/jpeg,image/png" class="hidden" />
    </div>
    <img id="preview" class="preview-img hidden" />
  </div>

  <div class="card">
    <label class="block text-pink-200 text-lg mb-2">ğŸ¨ é¸æ“‡é¢¨æ ¼</label>
    <div class="style-grid">
      <button class="style-btn active" data-style="dreamy">â˜ï¸ å¤¢å¹»ä»™å¢ƒ</button>
      <button class="style-btn" data-style="neon">ğŸ’œ éœ“è™¹éƒ½å¸‚</button>
      <button class="style-btn" data-style="sunset">ğŸŒ… æ—¥è½å…‰æšˆ</button>
      <button class="style-btn" data-style="vintage">ğŸ“· å¾©å¤è† ç‰‡</button>
    </div>
    <button id="generate-btn" class="generate-btn" disabled>âœ¨ é–‹å§‹è½‰æ›</button>
  </div>

  <div id="loading">
    <div class="spinner"></div>
    <p class="text-pink-200 text-lg">AI é­”æ³•è½‰æ›ä¸­...</p>
  </div>

  <div id="result" class="hidden">
    <h2 class="text-center text-pink-200 text-xl font-bold mb-3">âœ¨ å®Œæˆï¼</h2>
    <img id="result-img" class="result-img" />
    <button id="download-btn" class="generate-btn mt-4">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
  </div>
</div>

<script>
// === ä¸Šå‚³é è¦½ ===
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');
const preview = document.getElementById('preview');
const generateBtn = document.getElementById('generate-btn');
let base64Image = null;

uploadZone.onclick = () => fileInput.click();
uploadZone.ondragover = e => { e.preventDefault(); uploadZone.style.borderColor='#ff88ff'; };
uploadZone.ondragleave = () => uploadZone.style.borderColor='#d28fff';
uploadZone.ondrop = e => {
  e.preventDefault();
  handleFile(e.dataTransfer.files[0]);
};
fileInput.onchange = e => handleFile(e.target.files[0]);

function handleFile(file){
  if(!file) return;
  if(!file.type.match(/image.*/)) return alert("è«‹ä¸Šå‚³åœ–ç‰‡ï¼");
  const reader = new FileReader();
  reader.onload = e => {
    base64Image = e.target.result.split(',')[1];
    preview.src = e.target.result;
    preview.classList.remove('hidden');
    generateBtn.disabled = false;
  };
  reader.readAsDataURL(file);
}

// === é¢¨æ ¼é¸æ“‡ ===
let style = 'dreamy';
document.querySelectorAll('.style-btn').forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll('.style-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    style = btn.dataset.style;
  };
});

// === prompt è¨­å®š ===
const stylePrompts = {
  dreamy: "Transform this selfie into a dreamy aesthetic with pastel clouds, pink glow, soft bokeh, maintain face realism.",
  neon: "Transform this selfie into a cyberpunk neon city aesthetic with glowing purple lights, modern portrait, keep face unchanged.",
  sunset: "Transform this selfie with golden hour warm sunlight and sunset gradient sky, cinematic mood.",
  vintage: "Transform this selfie into a nostalgic film look with soft grain and faded tones, keep face realistic."
};

// === ç”Ÿæˆ ===
document.getElementById('generate-btn').onclick = async ()=>{
  if(!base64Image) return alert("è«‹å…ˆä¸Šå‚³åœ–ç‰‡ï¼");
  const loading = document.getElementById('loading');
  const resultDiv = document.getElementById('result');
  loading.style.display='block';
  resultDiv.classList.add('hidden');

  try {
    const res = await fetch('/api/gemini_beauty', {
      method: 'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ prompt: stylePrompts[style], base64Image })
    });
    const data = await res.json();
    loading.style.display='none';
    if(data.image_base64){
      document.getElementById('result-img').src='data:image/png;base64,'+data.image_base64;
      resultDiv.classList.remove('hidden');
    }else{
      alert("âŒ æ²’æœ‰ç”Ÿæˆåœ–ç‰‡ï¼š" + (data.error || "è«‹ç¨å¾Œå†è©¦"));
      console.log(data);
    }
  }catch(err){
    loading.style.display='none';
    alert("âš ï¸ è½‰æ›å¤±æ•—ï¼š" + err.message);
  }
};

// === ä¸‹è¼‰ ===
document.getElementById('download-btn').onclick = ()=>{
  const link=document.createElement('a');
  link.href=document.getElementById('result-img').src;
  link.download='beautified_'+Date.now()+'.png';
  link.click();
};
</script>
</body>
</html>
