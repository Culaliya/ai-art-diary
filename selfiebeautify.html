<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>âœ¨ AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  margin: 0;
  font-family: 'Orbitron', 'Noto Sans TC', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
  background-size: 400% 400%;
  animation: gradientShift 15s ease infinite;
  color: #fff;
  overflow-x: hidden;
  min-height: 100vh;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* é–ƒçˆå…‰é»èƒŒæ™¯ */
#sparkles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none;
}

.sparkle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: #fff;
  border-radius: 50%;
  animation: sparkle 3s ease-in-out infinite;
  box-shadow: 0 0 10px #fff, 0 0 20px #fff;
}

@keyframes sparkle {
  0%, 100% { opacity: 0; transform: scale(0); }
  50% { opacity: 1; transform: scale(1); }
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 20px;
  position: relative;
  z-index: 1;
}

/* æ¨™é¡Œ */
h1 {
  text-align: center;
  font-size: 3.5rem;
  font-weight: 900;
  background: linear-gradient(135deg, #fff, #f0f, #0ff, #fff);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowText 4s ease infinite;
  text-shadow: 0 0 30px rgba(255,255,255,0.5);
  margin-bottom: 10px;
  letter-spacing: 2px;
}

@keyframes rainbowText {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.subtitle {
  text-align: center;
  font-size: 1.2rem;
  color: #fff;
  margin-bottom: 50px;
  text-shadow: 0 0 20px rgba(255,255,255,0.5);
}

/* å¡ç‰‡ */
.card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 24px;
  padding: 30px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
  margin-bottom: 30px;
  border: 3px solid rgba(255,255,255,0.3);
}

/* ä¸Šå‚³å€åŸŸ */
.upload-zone {
  border: 3px dashed #667eea;
  border-radius: 16px;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
}

.upload-zone:hover {
  border-color: #f093fb;
  background: linear-gradient(135deg, rgba(240,147,251,0.2), rgba(79,172,254,0.2));
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(102,126,234,0.3);
}

.upload-icon {
  font-size: 4rem;
  margin-bottom: 15px;
  animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

/* é è¦½åœ–ç‰‡ */
.preview-img {
  max-width: 100%;
  max-height: 400px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  margin: 20px auto;
  display: block;
}

/* é¢¨æ ¼æŒ‰éˆ• */
.style-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin: 25px 0;
}

.style-btn {
  padding: 15px;
  border-radius: 16px;
  border: 3px solid transparent;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 1rem;
  text-align: center;
}

.style-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(102,126,234,0.5);
}

.style-btn.active {
  border-color: #fff;
  box-shadow: 0 0 30px rgba(255,255,255,0.6);
  transform: scale(1.05);
}

/* ç”ŸæˆæŒ‰éˆ• */
.generate-btn {
  width: 100%;
  padding: 18px;
  border-radius: 50px;
  background: linear-gradient(135deg, #f093fb, #f5576c);
  color: #fff;
  font-weight: bold;
  font-size: 1.3rem;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 10px 30px rgba(245,87,108,0.4);
  margin-top: 20px;
}

.generate-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 40px rgba(245,87,108,0.6);
}

.generate-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* å¼·åº¦æ»‘æ¡¿ */
.intensity-control {
  margin: 25px 0;
}

.intensity-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  color: #667eea;
  font-weight: bold;
}

.slider {
  width: 100%;
  height: 8px;
  border-radius: 5px;
  background: linear-gradient(90deg, #667eea, #f093fb);
  outline: none;
  -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #fff;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(102,126,234,0.5);
}

/* çµæœå€åŸŸ */
.result-container {
  text-align: center;
}

.result-images {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 20px;
}

.result-box {
  position: relative;
}

.result-label {
  font-weight: bold;
  color: #667eea;
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.download-btn {
  margin-top: 15px;
  padding: 10px 25px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}

.download-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 20px rgba(102,126,234,0.4);
}

/* Loading å‹•ç•« */
.loading {
  text-align: center;
  padding: 40px;
}

.loading-spinner {
  border: 4px solid rgba(255,255,255,0.3);
  border-top: 4px solid #667eea;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* æ‰‹æ©ŸéŸ¿æ‡‰å¼ */
@media (max-width: 768px) {
  h1 {
    font-size: 2.5rem;
  }
  
  .subtitle {
    font-size: 1rem;
  }
  
  .card {
    padding: 20px;
  }
  
  .result-images {
    grid-template-columns: 1fr;
  }
  
  .style-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 2rem;
  }
  
  .upload-zone {
    padding: 30px 15px;
  }
  
  .generate-btn {
    font-size: 1.1rem;
    padding: 15px;
  }
}

/* æ¨™ç±¤ */
label {
  color: #667eea;
  font-weight: bold;
  font-size: 1.1rem;
  display: block;
  margin-bottom: 15px;
}
</style>
</head>
<body>

<!-- é–ƒçˆå…‰é»èƒŒæ™¯ -->
<div id="sparkles"></div>

<div class="container">
  <h1>âœ¨ AI ç¶²ç¾æ¿¾é¡å¯¦é©—å®¤</h1>
  <p class="subtitle">ä¸Šå‚³è‡ªæ‹ï¼Œç¬é–“è®Šèº«ç¶²ç¾ï¼ä¿æŒå®¹è²Œï¼Œåªæ›èƒŒæ™¯èˆ‡æ°›åœ ğŸ’«</p>

  <!-- ä¸Šå‚³å€ -->
  <div class="card">
    <label>ğŸ“¸ ä¸Šå‚³ä½ çš„è‡ªæ‹ç…§</label>
    <div class="upload-zone" id="upload-zone">
      <div class="upload-icon">ğŸŒ¸</div>
      <p style="color: #667eea; font-size: 1.1rem; font-weight: 600;">é»æ“Šæˆ–æ‹–æ›³åœ–ç‰‡åˆ°é€™è£¡</p>
      <p style="color: #999; font-size: 0.9rem; margin-top: 10px;">æ”¯æ´ JPGã€PNG æ ¼å¼</p>
      <input type="file" id="file-input" accept="image/jpeg,image/png" style="display: none;">
    </div>
    
    <div id="preview-container" style="display: none; margin-top: 20px;">
      <img id="preview-image" class="preview-img" src="" alt="é è¦½">
    </div>
  </div>

  <!-- é¢¨æ ¼é¸æ“‡ -->
  <div class="card">
    <label>ğŸ¨ é¸æ“‡ç¶²ç¾é¢¨æ ¼</label>
    <div class="style-grid">
      <button class="style-btn active" data-style="dreamy">
        â˜ï¸ å¤¢å¹»ä»™å¢ƒ
      </button>
      <button class="style-btn" data-style="kawaii">
        ğŸŒ¸ æ—¥ç³»ç”œç¾
      </button>
      <button class="style-btn" data-style="vintage">
        ğŸ“· å¾©å¤è† ç‰‡
      </button>
      <button class="style-btn" data-style="sunset">
        ğŸŒ… æ—¥è½å…‰æšˆ
      </button>
      <button class="style-btn" data-style="neon">
        ğŸ’œ éœ“è™¹éƒ½å¸‚
      </button>
      <button class="style-btn" data-style="nature">
        ğŸŒ¿ æ¸…æ–°è‡ªç„¶
      </button>
    </div>

    <!-- ç¾åŒ–å¼·åº¦ -->
    <div class="intensity-control">
      <div class="intensity-label">
        <span>âœ¨ ç¾åŒ–å¼·åº¦</span>
        <span id="intensity-value">ä¸­ç­‰</span>
      </div>
      <input type="range" min="1" max="3" value="2" class="slider" id="intensity-slider">
    </div>

    <button class="generate-btn" id="generate-btn" disabled>
      ğŸ¨ é–‹å§‹è½‰æ›é­”æ³•
    </button>
  </div>

  <!-- çµæœå€ -->
  <div id="result-container" class="card" style="display: none;">
    <h2 style="color: #667eea; text-align: center; margin-bottom: 20px;">âœ¨ è½‰æ›å®Œæˆ</h2>
    <div class="result-images">
      <div class="result-box">
        <div class="result-label">åŸåœ–</div>
        <img id="original-image" class="preview-img" src="" alt="åŸåœ–">
      </div>
      <div class="result-box">
        <div class="result-label">ç¶²ç¾ç‰ˆæœ¬ ğŸ’•</div>
        <img id="result-image" class="preview-img" src="" alt="çµæœ">
        <button class="download-btn" id="download-btn">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
      </div>
    </div>
  </div>

  <!-- Loading ç‹€æ…‹ -->
  <div id="loading-container" class="card" style="display: none;">
    <div class="loading">
      <div class="loading-spinner"></div>
      <p style="color: #667eea; font-size: 1.2rem; font-weight: bold;">âœ¨ AI é­”æ³•è½‰æ›ä¸­...</p>
      <p style="color: #999; margin-top: 10px;">ä¿æŒå®¹è²Œï¼Œæ‰“é€ å®Œç¾èƒŒæ™¯æ°›åœ</p>
    </div>
  </div>
</div>

<script>
// === é–ƒçˆå…‰é»ç”Ÿæˆ ===
const sparklesContainer = document.getElementById('sparkles');
for (let i = 0; i < 30; i++) {
  const sparkle = document.createElement('div');
  sparkle.className = 'sparkle';
  sparkle.style.left = Math.random() * 100 + '%';
  sparkle.style.top = Math.random() * 100 + '%';
  sparkle.style.animationDelay = Math.random() * 3 + 's';
  sparklesContainer.appendChild(sparkle);
}

// === åœ–ç‰‡ä¸Šå‚³è™•ç† ===
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');
const previewContainer = document.getElementById('preview-container');
const previewImage = document.getElementById('preview-image');
const generateBtn = document.getElementById('generate-btn');
let base64Image = null;

uploadZone.onclick = () => fileInput.click();

fileInput.onchange = (e) => {
  const file = e.target.files[0];
  if (file) handleFile(file);
};

uploadZone.ondragover = (e) => {
  e.preventDefault();
  uploadZone.style.borderColor = '#f093fb';
};

uploadZone.ondrop = (e) => {
  e.preventDefault();
  const file = e.dataTransfer.files[0];
  if (file) handleFile(file);
};

function handleFile(file) {
  if (!file.type.match('image/(jpeg|png)')) {
    alert('è«‹ä¸Šå‚³ JPG æˆ– PNG æ ¼å¼çš„åœ–ç‰‡ï¼');
    return;
  }

  const reader = new FileReader();
  reader.onload = (e) => {
    base64Image = e.target.result.split(',')[1];
    previewImage.src = e.target.result;
    previewContainer.style.display = 'block';
    generateBtn.disabled = false;
  };
  reader.readAsDataURL(file);
}

// === é¢¨æ ¼é¸æ“‡ ===
let selectedStyle = 'dreamy';
const styleButtons = document.querySelectorAll('.style-btn');

styleButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    styleButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedStyle = btn.dataset.style;
  });
});

// === å¼·åº¦æ»‘æ¡¿ ===
const intensitySlider = document.getElementById('intensity-slider');
const intensityValue = document.getElementById('intensity-value');

intensitySlider.oninput = () => {
  const value = intensitySlider.value;
  const labels = ['è¼•æŸ”', 'ä¸­ç­‰', 'å¼·çƒˆ'];
  intensityValue.textContent = labels[value - 1];
};

// === é¢¨æ ¼ Prompt å®šç¾© ===
const stylePrompts = {
  dreamy: `Transform this selfie into a dreamy aesthetic with soft pastel colors, ethereal bokeh lights, 
  floating sparkles, cotton candy clouds background, gentle pink and purple gradient sky, 
  maintain original facial features perfectly, professional portrait photography, 
  Instagram aesthetic, soft focus background only`,
  
  kawaii: `Transform this selfie with kawaii Japanese aesthetic, cherry blossom petals floating around,
  soft pink theme, cute heart and star decorations, pastel rainbow background,
  anime-style atmosphere but keep real human face unchanged, kawaii filter effect,
  Harajuku street style vibes, maintain facial features exactly`,
  
  vintage: `Transform this selfie with vintage film camera aesthetic, warm analog film grain,
  golden hour lighting, nostalgic 90s atmosphere, retro color grading with faded tones,
  soft vignette edges, keep face completely natural and unchanged, 
  classic portrait photography style, timeless background`,
  
  sunset: `Transform this selfie with magical sunset golden hour, warm orange and pink sky,
  sun flare effects, glowing rim light on hair, cinematic color grading,
  lens bokeh with warm tones, keep facial features identical, 
  professional photography lighting, dreamy sunset background gradient`,
  
  neon: `Transform this selfie with cyberpunk neon city aesthetic, vibrant neon lights background,
  purple and cyan color scheme, urban night photography, glowing neon signs,
  modern city lights bokeh, maintain face completely unchanged,
  futuristic portrait style, neon glow atmosphere`,
  
  nature: `Transform this selfie with fresh natural aesthetic, lush green forest background,
  soft natural sunlight filtering through leaves, botanical garden vibes,
  fresh flowers and plants around, maintain facial features perfectly,
  outdoor natural portrait, organic and clean aesthetic, morning dew atmosphere`
};

// === ç”Ÿæˆè™•ç† ===
generateBtn.onclick = async () => {
  if (!base64Image) {
    alert('è«‹å…ˆä¸Šå‚³ç…§ç‰‡ï¼');
    return;
  }

  // é¡¯ç¤º loading
  document.getElementById('loading-container').style.display = 'block';
  document.getElementById('result-container').style.display = 'none';

  // ç²å–é¸æ“‡çš„é¢¨æ ¼å’Œå¼·åº¦
  const prompt = stylePrompts[selectedStyle];
  const intensity = intensitySlider.value;
  const temperature = [0.6, 0.8, 1.0][intensity - 1];

  try {
    const response = await fetch('/api/gemini_vision', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        prompt: prompt,
        base64Image: base64Image,
        temperature: temperature
      })
    });

    const data = await response.json();

    if (data.success && data.image_base64) {
      // é¡¯ç¤ºçµæœ
      document.getElementById('original-image').src = previewImage.src;
      document.getElementById('result-image').src = 'data:image/png;base64,' + data.image_base64;
      document.getElementById('result-container').style.display = 'block';
      
      // æ»¾å‹•åˆ°çµæœ
      document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
    } else {
      throw new Error(data.error || 'ç”Ÿæˆå¤±æ•—');
    }
  } catch (error) {
    alert('âŒ è½‰æ›å¤±æ•—ï¼š' + error.message);
    console.error(error);
  } finally {
    document.getElementById('loading-container').style.display = 'none';
  }
};

// === ä¸‹è¼‰åŠŸèƒ½ ===
document.getElementById('download-btn').onclick = () => {
  const resultImage = document.getElementById('result-image');
  const link = document.createElement('a');
  link.href = resultImage.src;
  link.download = `ç¾åŒ–ç…§ç‰‡_${selectedStyle}_${Date.now()}.png`;
  link.click();
};
</script>

</body>
</html>
