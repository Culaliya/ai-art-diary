<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Beauty Studio ğŸ’„</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans TC", "Poppins", sans-serif;
      background: linear-gradient(135deg, #f8d3ff, #ffe6f8, #fff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }

    .container {
      width: 480px; /* â† ç¸®å°ç‚ºä¸€åŠå°ºå¯¸ */
      max-width: 90%;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(255, 160, 200, 0.3);
      border-radius: 18px;
      padding: 24px 30px 30px 30px;
      text-align: center;
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 22px;
      letter-spacing: 1px;
      background: linear-gradient(90deg, #ff6bc7, #ff8ad1, #ffb0dc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 18px;
    }

    input[type="file"] {
      display: none;
    }

    label.upload-btn {
      display: inline-block;
      padding: 10px 20px;
      background: linear-gradient(90deg, #ff92c2, #ffa6d7);
      color: white;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.2s ease;
    }
    label.upload-btn:hover {
      transform: scale(1.05);
      background: linear-gradient(90deg, #ff78a9, #ff94d5);
    }

    .preview {
      display: none;
      width: 100%;
      border-radius: 12px;
      margin: 12px 0;
      box-shadow: 0 0 12px rgba(255, 175, 200, 0.3);
    }

    .styles {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 10px;
      gap: 6px;
    }

    .style-btn {
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      background: #ffeaf5;
      cursor: pointer;
      font-size: 13px;
      color: #444;
      transition: all 0.2s ease;
    }
    .style-btn.active,
    .style-btn:hover {
      background: linear-gradient(90deg, #ff8aca, #ffb6d9);
      color: white;
      transform: scale(1.05);
    }

    .btn {
      padding: 12px 26px;
      font-size: 15px;
      font-weight: 600;
      border-radius: 14px;
      border: none;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 10px 5px;
      background: linear-gradient(90deg, #ff88ca, #ffafd5);
      box-shadow: 0 5px 12px rgba(255, 160, 200, 0.3);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(255, 160, 200, 0.45);
    }

    .hidden { display: none; }

    #loading {
      margin: 20px 0;
      color: #ff6ba5;
      font-weight: 500;
    }

    #result img {
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 160, 200, 0.3);
    }

    /* èƒ½é‡æ¢ */
    .energy-bar {
      width: 100%;
      height: 10px;
      background: #ffe1f1;
      border-radius: 8px;
      margin-top: 14px;
      overflow: hidden;
    }
    #energy-fill {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #ff9df9, #ffbdfc);
      transition: width 0.5s ease;
    }

    footer {
      margin-top: 12px;
      font-size: 12px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Beauty Studio ğŸ’„</h1>

    <!-- ä¸Šå‚³ -->
    <label class="upload-btn" for="file-input">ğŸ“· ä¸Šå‚³åœ–ç‰‡</label>
    <input type="file" id="file-input" accept="image/*" />
    <img id="preview" class="preview" />

    <!-- é¢¨æ ¼é¸æ“‡ -->
    <div class="styles">
      <button class="style-btn active" data-style="pure">è‡ªç„¶å…‰</button>
      <button class="style-btn" data-style="k_id">éŸ“ç³»è­‰ä»¶</button>
      <button class="style-btn" data-style="kimono">å’Œæœé¢¨</button>
      <button class="style-btn" data-style="princess">å…¬ä¸»é¢¨</button>
      <button class="style-btn" data-style="vogue">æ™‚å°šæ£šæ‹</button>
    </div>

    <!-- ç”Ÿæˆ -->
    <div style="margin-top:18px;">
      <button id="generate-btn" class="btn">âœ¨ ç”Ÿæˆç¾åŒ–åœ–</button>
      <button id="download-btn" class="btn">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
    </div>

    <div id="loading" class="hidden">â³ AI ç¾åŒ–ä¸­ï¼Œè«‹ç¨å€™...</div>

    <div id="result" class="hidden">
      <img id="result-img" alt="çµæœåœ–" />
    </div>

    <!-- èƒ½é‡æ¢ -->
    <div class="energy-bar"><div id="energy-fill"></div></div>

    <footer>æ¯æ—¥ä¸Šé™ 5 æ¬¡ãƒ»å†·å» 30 ç§’</footer>
  </div>

  <script>
    let base64Image = "";
    const preview = document.getElementById("preview");
    const generateBtn = document.getElementById("generate-btn");

    // === ä¸Šå‚³åœ–ç‰‡ ===
    document.getElementById("file-input").onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        base64Image = reader.result;
        preview.src = base64Image;
        preview.classList.remove("hidden");
        generateBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    };

    // === é¢¨æ ¼é¸æ“‡ ===
    let style = "pure";
    document.querySelectorAll(".style-btn").forEach((btn) => {
      btn.onclick = () => {
        document
          .querySelectorAll(".style-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        style = btn.dataset.style;
      };
    });

    // === ç”Ÿæˆ ===
    document.getElementById("generate-btn").onclick = async () => {
      if (!base64Image) return alert("è«‹å…ˆä¸Šå‚³åœ–ç‰‡ï¼");
      document.getElementById("loading").classList.remove("hidden");
      document.getElementById("result").classList.add("hidden");

      try {
        const res = await fetch("/api/gemini_beauty", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ style: style, base64Image }),
        });
        const data = await res.json();
        document.getElementById("loading").classList.add("hidden");

        if (res.status === 429) {
          if (data.cooldown) alert(`ğŸ’« è«‹ç¨å€™ ${data.cooldown} ç§’å†è©¦`);
          else if (data.energy === 0)
            alert("âš ï¸ ä»Šæ—¥èƒ½é‡å·²è€—ç›¡ï¼Œæ˜å¤©å†è©¦ï½");
          updateEnergyBar(data.energy || 0);
          return;
        }

        if (data.image_base64) {
          document.getElementById("result-img").src =
            "data:image/png;base64," + data.image_base64;
          document.getElementById("result").classList.remove("hidden");
          updateEnergyBar(data.energy);
        } else alert("âŒ æ²’æœ‰ç”Ÿæˆåœ–ç‰‡ï¼š" + (data.error || "è«‹ç¨å¾Œå†è©¦"));
      } catch (err) {
        document.getElementById("loading").classList.add("hidden");
        alert("âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message);
      }
    };

    // === èƒ½é‡æ¢ ===
    function updateEnergyBar(energy) {
      const fill = document.getElementById("energy-fill");
      const percent = Math.max(0, Math.min(100, (energy / 5) * 100));
      fill.style.width = percent + "%";
      fill.style.background =
        percent > 40
          ? "linear-gradient(90deg,#ff9df9,#ffbdfc)"
          : "linear-gradient(90deg,#ff6b9d,#ffc0c0)";
    }

    // === ä¸‹è¼‰ ===
    document.getElementById("download-btn").onclick = () => {
      const link = document.createElement("a");
      link.href = document.getElementById("result-img").src;
      link.download = "beauty_" + Date.now() + ".png";
      link.click();
    };
  </script>
</body>
</html>
