<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸ‘ï¸ éˆç•°é¡¯åƒå„€ v6.6ï¼šéˆå£“å…±é³´å‡ç´šç‰ˆ</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at 50% 20%, #0a0015 0%, #220044 60%, #000 100%);
  font-family: 'Noto Sans TC', sans-serif;
  color: #e6d4ff;
  overflow-y: auto;
  min-height: 100vh;
}

/* ğŸŒ«ï¸ éœ§å±¤ */
#fogLayer {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: radial-gradient(circle at 50% 80%, rgba(180,0,255,0.15) 0%, transparent 60%),
              radial-gradient(circle at 20% 30%, rgba(120,60,255,0.12) 0%, transparent 50%),
              radial-gradient(circle at 80% 40%, rgba(255,0,255,0.15) 0%, transparent 60%);
  animation: fogMove 30s ease-in-out infinite alternate;
  filter: blur(80px);
  z-index: 0;
}
@keyframes fogMove {
  0% {transform: translate(0,0) scale(1);}
  100% {transform: translate(-20px,10px) scale(1.2);}
}

/* ğŸ‘» å¹½éˆé›¨ */
#ghostRain {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 1; pointer-events: none;
}

/* ğŸ’œ éˆæ³¢é–ƒå…‰ */
#pulse {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle at 50% 50%, rgba(255,0,255,0.15), transparent 70%);
  mix-blend-mode: screen;
  opacity: 0;
  animation: pulseWave 4s ease-in-out infinite;
  z-index: 2;
}
@keyframes pulseWave {
  0%,100% {opacity:0;}
  50% {opacity:0.5;}
}

/* âš¡ ç•«é¢å¹²æ“¾é–ƒçˆ */
@keyframes glitchFlash {
  0%,100% {opacity:0;}
  45% {opacity:0.25;}
  48% {opacity:0.8;}
  50% {opacity:0.2;}
  52% {opacity:0.9;}
  55% {opacity:0;}
}
#glitch {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: repeating-linear-gradient(0deg, rgba(255,0,255,0.08) 0 2px, transparent 2px 4px);
  mix-blend-mode: screen;
  opacity: 0;
  animation: glitchFlash 6s infinite;
  z-index: 3;
}

/* ğŸ§Š å¡ç‰‡ */
.card {
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(200,140,255,0.4);
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(170,100,255,0.3);
  backdrop-filter: blur(12px);
  transition: all .3s;
  z-index: 5;
}
.card:hover {box-shadow:0 0 40px rgba(220,160,255,0.7);transform:translateY(-3px);}

/* æ¨™é¡Œ - åŠ å¤§ï¼‹ä¸‹ç§»ï¼‹æŸ”åŒ– */
h1 {
  text-align: center;
  font-size: 9rem;
  margin-top: 220px;
  padding: 0 20px;
  color: #ff4dff;
  text-shadow: 0 0 40px #ff0080, 0 0 80px #b000ff, 0 0 120px #8000ff, 0 0 160px #ff0080;
  font-weight: 900;
  animation: titleGlow 3s ease-in-out infinite;
  letter-spacing: 8px;
  line-height: 1.1;
}
@keyframes titleGlow {
  0%,100% {
    text-shadow: 0 0 40px #ff0080, 0 0 80px #b000ff, 0 0 120px #8000ff;
    transform: scale(1);
  }
  50% {
    text-shadow: 0 0 60px #ff3eff, 0 0 120px #ff0080, 0 0 180px #b000ff;
    transform: scale(1.03);
  }
}
p.sub {
  text-align: center;
  color: #ff99ff;
  font-size: 2.2rem;
  margin-top: 40px;
  margin-bottom: 100px;
  padding: 0 20px;
  text-shadow: 0 0 20px #ff3eff, 0 0 40px #b000ff;
  font-weight: 600;
  letter-spacing: 3px;
}

/* éˆå£“è€—ç›¡é–ƒçˆæ•ˆæœ */
#energy-bar.depleted {
  animation: flicker 1.2s infinite alternate;
}
@keyframes flicker {
  0%,100% { background: rgba(255, 80, 80, 0.5); }
  50% { background: rgba(255, 0, 0, 0.9); box-shadow: 0 0 15px #ff0000; }
}
/* ğŸ”® éˆå£“èƒ½é‡æ¢èª¿æ•´ï¼šè‡ªå‹•ä¸‹ç§»æ™‚é˜²æ­¢é®è“‹ */
@media (max-width: 768px) {
  #energy-text {
    font-size: 1rem;
  }
  .fixed.top-20 {
    top: 4.5rem !important;
    width: 85% !important;
  }
}

  
</style>
</head>

<body>
<canvas id="ghostRain"></canvas>
<div id="fogLayer"></div>
<div id="pulse"></div>
<div id="glitch"></div>

<!-- âš¡ éˆå£“èƒ½é‡æ¢ -->
<div class="fixed top-20 left-1/2 transform -translate-x-1/2 w-96 text-center z-50">
  <p id="energy-text" class="text-purple-300 text-lg mb-2 drop-shadow-[0_0_10px_#ff3eff]">
    ğŸ‘ï¸ éˆå£“èƒ½é‡ 3/3
  </p>
  <div class="w-full h-4 bg-purple-950/40 rounded-full overflow-hidden border border-purple-600/50 shadow-[0_0_15px_#b065ff]">
    <div id="energy-bar" class="h-full bg-gradient-to-r from-purple-400 to-pink-500 transition-all duration-700"></div>
  </div>
</div>


<h1>ğŸ‘ï¸ éˆç•°é¡¯åƒå„€</h1>
<p class="sub">ä¸Šå‚³è‡ªæ‹ï¼Œçœ‹ AI æ˜¯å¦èƒ½æ•æ‰åˆ°ã€Œç¥‚ã€çš„æ®˜å½±â€¦â€¦</p>

<div class="container mx-auto max-w-2xl relative z-10 pb-20">
  <div class="card p-6 mb-6">
    <label class="block text-lg font-semibold text-purple-300 mb-3">ä¸Šå‚³ç…§ç‰‡</label>
    <div id="drop-zone" class="flex justify-center items-center border-2 border-dashed border-purple-400 rounded-lg p-8 cursor-pointer hover:border-purple-500 transition">
      <p class="text-sm text-purple-200">æ‹–æ›³åœ–ç‰‡æˆ–é»æ“Šä¸Šå‚³</p>
      <input id="file-upload" type="file" accept="image/png,image/jpeg" class="hidden" />
    </div>
    <div id="preview-container" class="hidden mt-4 text-center">
      <p class="text-sm text-gray-400 mb-2">é è¦½ï¼š</p>
      <img id="preview-image" src="" class="max-h-64 mx-auto rounded-lg border border-purple-500 shadow-md">
    </div>
  </div>

  <div class="card p-6 mb-6 text-center">
    <label class="block text-lg font-semibold text-purple-300 mb-2">æƒ³å¬å–šä»€éº¼æ°£æ°›ï¼Ÿ</label>
    <select id="mode" class="p-3 rounded-md bg-purple-950/40 border border-purple-500/40 text-purple-100 focus:ring-2 focus:ring-purple-500 mb-4">
      <option value="spirit">ğŸ‘ éˆé«”é¡¯åƒ</option>
      <option value="phantom">ğŸ’€ æƒ¡éˆæ®˜å½±</option>
      <option value="dream">ğŸŒ« å¤¢å¢ƒä¹‹å½±</option>
    </select>

    <button id="generate-button" class="mt-6 px-6 py-3 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-bold shadow-lg transition">é–‹å§‹é¡¯åƒ</button>
  </div>

  <div id="result-container" class="hidden space-y-6">
    <div class="card p-4 text-center">
      <h2 class="text-lg font-semibold text-purple-300 mb-2">é¡¯åƒçµæœï¼š</h2>
      <img id="result-image" src="" class="max-h-96 mx-auto rounded-lg border border-purple-500 shadow-lg">
      <p id="result-text" class="mt-4 italic text-purple-200">æ­£åœ¨é¡¯åƒä¸­â€¦</p>
    </div>
  </div>
</div>

<audio id="humSound" src="https://cdn.pixabay.com/download/audio/2023/02/27/audio_76f9d86c8e.mp3?filename=ghost-hum-139482.mp3"></audio>

<script>
// === âš¡ éˆå£“èƒ½é‡ç³»çµ± ===
const MAX_USES_PER_DAY = 3;
const usageKey = "ghostVisionUsage";
const today = new Date().toISOString().split("T")[0];
let usageData = JSON.parse(localStorage.getItem(usageKey)) || {};
if (usageData.date !== today) usageData = { date: today, count: 0 };
updateEnergyBar();

function updateEnergyBar() {
  const energyLeft = MAX_USES_PER_DAY - usageData.count;
  const bar = document.getElementById("energy-bar");
  const label = document.getElementById("energy-text");
  const ratio = Math.max(energyLeft / MAX_USES_PER_DAY, 0);
  bar.style.width = `${ratio * 100}%`;
  if (ratio > 0.6) bar.style.background = "#9f5bff";
  else if (ratio > 0.3) bar.style.background = "#ff69b4";
  else bar.style.background = "#ff3b3b";
  label.textContent = `ğŸ‘ï¸ éˆå£“èƒ½é‡ ${energyLeft}/${MAX_USES_PER_DAY}`;
  if (energyLeft === 0) {
    bar.classList.add("depleted");
    label.textContent = "ğŸ‘ï¸ éˆå£“ç‚ºé›¶ Â· å„€å™¨å†·å»ä¸­";
  } else bar.classList.remove("depleted");
}

function checkUsageLimit() {
  if (usageData.count >= MAX_USES_PER_DAY) {
    alert("ğŸ‘ï¸ ä»Šæ—¥éˆå£“å·²è€—ç›¡ï¼Œè«‹æ˜å¤©å†è©¦ï¼");
    return false;
  }
  usageData.count++;
  localStorage.setItem(usageKey, JSON.stringify(usageData));
  updateEnergyBar();
  return true;
}

// === ä¸Šå‚³ + é è¦½ ===
const upload = document.getElementById("file-upload");
const dropZone = document.getElementById("drop-zone");
let base64Logo = null;
dropZone.onclick = () => upload.click();
upload.onchange = e => handleFile(e.target.files[0]);
dropZone.ondrop = e => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
dropZone.ondragover = e => e.preventDefault();

function handleFile(file){
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    base64Logo = e.target.result.split(',')[1];
    document.getElementById('preview-image').src = e.target.result;
    document.getElementById('preview-container').classList.remove('hidden');
  };
  reader.readAsDataURL(file);
}

// === é¡¯åƒ ===
document.getElementById("generate-button").onclick = async () => {
  if (!checkUsageLimit()) return;
  if (!base64Logo) return alert("è«‹å…ˆä¸Šå‚³ç…§ç‰‡ï¼");
  const hum = document.getElementById("humSound");
  hum.currentTime = 0; hum.play();
  const resultImg = document.getElementById("result-image");
  const text = document.getElementById("result-text");
  document.getElementById("result-container").classList.remove("hidden");
  text.textContent = "ğŸ‘ï¸ é¡¯åƒä¸­â€¦éˆæ³¢å¹²æ“¾é–‹å§‹ã€‚";

  const mode = document.getElementById("mode").value;
  let prompt = "";
  if (mode === "spirit") prompt = "Generate a mystical spectral overlay with translucent spirits, glowing violet aura, cinematic ghost film style.";
  else if (mode === "phantom") prompt = "Generate a horror ghost overlay with cursed red-purple mist, screaming phantoms, cinematic eerie lighting.";
  else prompt = "Generate a surreal dreamlike spectral aura with pastel fog, lucid glow, ethereal shapes fading in mist.";

  try {
    const res = await fetch("/api/gemini_vision", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ prompt, base64Logo })
    });
    const data = await res.json();
    if (data.image_base64) {
      resultImg.src = "data:image/png;base64," + data.image_base64;
      text.textContent = "ğŸ‘ï¸ é¡¯åƒå®Œæˆï¼Œéˆæ³¢å…±æŒ¯ç©©å®šã€‚";
      hum.pause();
    } else throw new Error(data.error || "AI æ²’å›å‚³å½±åƒ");
  } catch (err) {
    console.error(err);
    text.textContent = "âš ï¸ é¡¯åƒå¤±æ•—ï¼š" + err.message;
    hum.pause();
  }
};

// === å¹½éˆé›¨ ===
const canvas = document.getElementById('ghostRain');
const ctx = canvas.getContext('2d');
let width, height, ghosts = [];
function resize(){ width=canvas.width=window.innerWidth; height=canvas.height=window.innerHeight; }
window.addEventListener('resize', resize);
resize();

class Ghost{
  constructor(){this.reset();}
  reset(){
    this.x=Math.random()*width;
    this.y=Math.random()*-height;
    this.size=Math.random()*50+25;
    this.speed=Math.random()*1.8+0.6;
    this.alpha=Math.random()*0.7+0.4;
    this.emoji=Math.random()<0.5?"ğŸ‘»":"ğŸ’€";
  }
  update(){this.y+=this.speed;if(this.y>height+50)this.reset();}
  draw(){
    ctx.globalAlpha=this.alpha*1.3; // æäº®
    ctx.font=`${this.size}px 'Segoe UI Emoji'`;
    ctx.fillText(this.emoji,this.x,this.y);
  }
}
for(let i=0;i<45;i++)ghosts.push(new Ghost());
function animate(){
  ctx.clearRect(0,0,width,height);
  for(const g of ghosts){g.update();g.draw();}
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
