<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸ” AI æ¯’èˆŒå¡è·¯é‡Œè¨ˆç®—æ©Ÿ v4</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    margin:0;
    overflow-x:hidden;
    background:radial-gradient(circle at 50% 20%, #1a0000 0%, #250000 60%, #000 100%);
    color:#fff;
    font-family:'Noto Sans TC',sans-serif;
  }

  /* ğŸ” èƒŒæ™¯æ¼¢å ¡é›¨ */
  #burgerRain {
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    z-index:0;
    pointer-events:none;
  }

  /* ğŸ§Š å¡ç‰‡é¢¨æ ¼ */
  .card {
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,100,100,0.4);
    border-radius:16px;
    box-shadow:0 0 15px rgba(255,80,80,0.3);
    backdrop-filter:blur(10px);
    transition:all .3s ease;
  }
  .card:hover {
    box-shadow:0 0 30px rgba(255,100,100,0.6);
    transform:translateY(-4px) scale(1.02);
  }

  /* æ¨™é¡Œå€å¡Š */
  header {
    text-align:center;
    margin-top:80px;
    margin-bottom:30px;
  }
  header h1 {
    font-size:2.6rem;
    font-weight:900;
    color:#ff4b4b;
    text-shadow:0 0 25px #ff2222;
  }
  header p {
    font-size:1.2rem;
    color:#ffcccc;
    margin-top:10px;
    letter-spacing:1px;
  }

  /* ğŸ”Š å˜´å·´å‹•ç•« */
  #mouth {
    width:100px;
    height:60px;
    border-radius:0 0 60px 60px;
    background:radial-gradient(circle at center, #ff6666 0%, #880000 90%);
    box-shadow:0 0 30px rgba(255,0,0,0.6);
    margin:20px auto 0;
    position:relative;
    overflow:hidden;
    transition:all 0.2s ease;
  }
  #mouth::before {
    content:"";
    position:absolute;
    width:90%;
    height:20px;
    background:#400000;
    border-radius:50%;
    top:5px;
    left:5%;
  }
  .mouth-speaking {
    animation:mouthMove 0.15s infinite alternate;
  }
  @keyframes mouthMove {
    from { transform:scaleY(0.4); box-shadow:0 0 10px #ff2222; }
    to   { transform:scaleY(1.2); box-shadow:0 0 40px #ff6666; }
  }

</style>
<link rel="stylesheet" href="mobile-ui.css">
</head>
<body class="text-red-100 antialiased">
<canvas id="burgerRain"></canvas>

<header>
  <h1>ğŸ” AI æ¯’èˆŒå¡è·¯é‡Œè¨ˆç®—æ©Ÿ</h1>
  <p>è®“ AI å˜´çˆ†ä½ çš„å®µå¤œç½ªæƒ¡æ„Ÿ ğŸ˜ˆ</p>
  <div id="mouth"></div>
</header>

<div class="container mx-auto max-w-2xl mt-10 relative z-10">

  <!-- ä¸Šå‚³å¡ç‰‡ -->
  <div class="card p-6 mb-6">
    <label class="block text-lg font-semibold text-red-300 mb-3">ä¸Šå‚³é£Ÿç‰©ç…§ç‰‡</label>
    <div id="drop-zone" class="flex justify-center items-center border-2 border-dashed border-red-400 rounded-lg p-8 cursor-pointer hover:border-red-500 transition">
      <p class="text-sm text-red-200">æ‹–æ›³åœ–ç‰‡æˆ–é»æ“Šä¸Šå‚³</p>
      <input id="file-upload" type="file" accept="image/png,image/jpeg" class="hidden" />
    </div>

    <!-- é è¦½ -->
    <div id="preview-container" class="hidden mt-4 text-center">
      <p class="text-sm text-gray-400 mb-2">é è¦½ï¼š</p>
      <img id="preview-image" src="" class="max-h-64 mx-auto rounded-lg border border-red-500 shadow-md">
    </div>
  </div>

  <!-- æç¤º -->
  <div class="card p-6 mb-6">
    <label class="block text-lg font-semibold text-red-300 mb-2">æƒ³èªªé»ä»€éº¼ï¼Ÿ</label>
    <textarea id="prompt" rows="2" class="w-full p-3 rounded-md bg-red-950/40 border border-red-500/40 text-red-100 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="ä¾‹å¦‚ï¼šé€™æ˜¯æˆ‘æ—©é¤ï¼Œè«‹å˜´ä¸€å˜´..."></textarea>
  </div>

  <!-- æŒ‰éˆ• -->
  <div class="flex justify-center mb-6">
    <button id="generate-button" class="px-6 py-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold shadow-lg transition">é–‹å§‹åˆ†æ</button>
  </div>

  <!-- çµæœ -->
  <div id="result-container" class="hidden space-y-6">
    <div class="card p-4">
      <h2 class="text-lg font-semibold text-red-300 mb-2">AI è©•è«–ï¼š</h2>
      <p id="result-review" class="italic text-red-100"></p>
      <div class="mt-4 flex gap-3 items-center justify-center">
        <button id="play-voice" class="hidden px-4 py-2 bg-red-500 rounded-lg hover:bg-red-600 text-white font-semibold">ğŸ”Š æ’­æ”¾æ¯’èˆŒèªéŸ³</button>
        <select id="voice-style" class="bg-red-900 border border-red-500 rounded-lg p-1 text-sm text-white">
          <option value="calm">å†·æ·¡èªæ°£ ğŸ˜</option>
          <option value="angry">æš´èºç½µäºº ğŸ˜¡</option>
        </select>
      </div>
    </div>

    <div class="card p-4">
      <h2 class="text-lg font-semibold text-red-300 mb-2">ä¼°ç®—ç†±é‡ï¼š</h2>
      <p id="result-calories" class="text-4xl font-bold text-white"></p>
    </div>

    <div class="card p-4">
      <h2 class="text-lg font-semibold text-red-300 mb-2">åµæ¸¬åˆ°çš„é£Ÿç‰©ï¼š</h2>
      <ul id="result-items" class="list-disc list-inside text-red-200"></ul>
    </div>
  </div>
</div>

<script>
// === ä¸Šå‚³ + é è¦½ ===
const upload = document.getElementById('file-upload');
const dropZone = document.getElementById('drop-zone');
const button = document.getElementById('generate-button');
const result = document.getElementById('result-container');
let base64Logo = null;

dropZone.onclick = () => upload.click();
upload.onchange = e => handleFile(e.target.files[0]);
dropZone.ondrop = e => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
dropZone.ondragover = e => e.preventDefault();

function handleFile(file){
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    base64Logo = e.target.result.split(',')[1];
    const previewContainer = document.getElementById('preview-container');
    const previewImage = document.getElementById('preview-image');
    previewImage.src = e.target.result;
    previewContainer.classList.remove('hidden');
  };
  reader.readAsDataURL(file);
}

// === åˆ†ææŒ‰éˆ• ===
button.onclick = async () => {
  if(!base64Logo) return alert('è«‹å…ˆä¸Šå‚³é£Ÿç‰©ç…§ç‰‡ï¼');
  button.textContent = "åˆ†æä¸­...";
  const res = await fetch('/api/gemini', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      base64Logo,
      prompt: document.getElementById('prompt').value
    })
  });
  const data = await res.json();
  if(data.error){ alert(data.error); button.textContent="é–‹å§‹åˆ†æ"; return; }

  document.getElementById('result-review').textContent = data.review;
  document.getElementById('result-calories').textContent = data.estimated_calories + ' kcal';
  document.getElementById('result-items').innerHTML = data.items.map(i=>`<li>${i}</li>`).join('');
  result.classList.remove('hidden');
  button.textContent = "å†åˆ†æä¸€æ¬¡";
  document.getElementById('play-voice').classList.remove('hidden');
};

// === AI æ¯’èˆŒèªéŸ³æ’­å ± + å˜´å·´å‹•ç•« ===
const mouth = document.getElementById("mouth");
document.getElementById('play-voice').addEventListener('click', ()=>{
  const text = document.getElementById('result-review').textContent.trim();
  if(!text) return alert("é‚„æ²’æœ‰è©•è«–å¯ä»¥æ’­æ”¾å–”ï¼");
  const style = document.getElementById('voice-style').value;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "zh-TW";
  utter.rate = style === "angry" ? 1.4 : 1.0;
  utter.pitch = style === "angry" ? 0.6 : 1.1;
  utter.volume = 1;

  utter.onstart = ()=>{
    console.log("ğŸ¤ é–‹å§‹æ’­å ±");
    mouth.classList.add('mouth-speaking');
  };
  utter.onend = ()=>{
    console.log("âœ… æ’­å ±çµæŸ");
    mouth.classList.remove('mouth-speaking');
  };

  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
});

// === èƒŒæ™¯æ¼¢å ¡é›¨ ===
const canvas = document.getElementById('burgerRain');
const ctx = canvas.getContext('2d');
let width, height, burgers = [];

function resize(){
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

class Burger {
  constructor(){
    this.x = Math.random() * width;
    this.y = Math.random() * -height;
    this.size = Math.random() * 40 + 30;
    this.speed = Math.random() * 1 + 0.5;
    this.emoji = "ğŸ”";
  }
  update(){
    this.y += this.speed;
    if(this.y > height + 50){
      this.y = -50;
      this.x = Math.random() * width;
    }
  }
  draw(){
    ctx.font = `${this.size}px 'Segoe UI Emoji'`;
    ctx.fillText(this.emoji, this.x, this.y);
  }
}
for(let i=0;i<25;i++) burgers.push(new Burger());
function animate(){
  ctx.clearRect(0,0,width,height);
  for(const b of burgers){ b.update(); b.draw(); }
  requestAnimationFrame(animate);
}
animate();
</script>
<script src="mobile-nav.js"></script>
</body>
</html>
